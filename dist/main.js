(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t,n){t=e.sym(t);let r=e.any(t,n);return r?r.value:""}function r(e,t,n){t=e.sym(t);let r=e.each(t,n),l=[];for(let e of r)l.push(e?e.value:"");return l}async function l(e,t,l){e||=document;let o=window.origin;t||=`${o}/profile/card#me`;const a=(t=await async function(e){const t=UI.rdf,l=t.Namespace("http://www.w3.org/2000/01/rdf-schema#"),o=t.Namespace("http://xmlns.com/foaf/0.1/"),a=t.Namespace("http://www.w3.org/ns/solid/terms#"),i=t.Namespace("http://www.w3.org/ns/pim/space#"),s=t.Namespace("http://www.w3.org/ns/ldp#"),c=t.Namespace("http://www.w3.org/2006/vcard/ns#"),d=window.kb,u=t.fetcher(d),p=t.sym(e);try{await u.load(e)}catch(e){return console.log("Couldn't load profile : "+e),{}}let y=d.each(e,l("seeAlso"));y=y.concat(d.each(p,o("primaryTopicOf")));for(let e of y)await u.load(e);return{webId:e,name:n(d,e,o("name"))||n(d,e,c("fn"))||n(d,e,o("nick"))||e,nick:n(d,e,o("nick"))||"",image:n(d,e,c("hasPhoto"))||"",inbox:n(d,e,s("inbox"))||"",preferences:n(d,e,i("preferencesFile"))||"",privateTypeIndex:n(d,e,a("privateTypeIndex"))||"",publicTypeIndex:n(d,e,a("publicTypeIndex"))||"",storages:r(d,e,i("storage"))||"",issuers:r(d,e,a("oidcIssuer"))||""}}(t)).storages?t.storages[0]:null;t.name=t.name||t.nick||t.webId;let i=e.querySelector("#currentPodLogo");i&&(i.src=t.image);let s=e.querySelector("#currentPodTitle");return s&&(s.innerHTML=`${t.name}'s Pod`),solidUI.vars={podRoot:a,podName:t.name,podNick:t.nick,podWebID:t.webId,podImage:t.image,podInbox:t.inbox,podProfile:t.webId},t}e.r(t),e.d(t,{CU:()=>d});class o{async fetchAndParse(e,t){e=(t||"")+encodeURI(e);let n=await fetch(e),r=await n.text(),l=(new window.DOMParser).parseFromString(r,"text/xml"),o=l.querySelectorAll("item")||null;o=o.length<1?l.querySelectorAll("entry"):o;let a=[];return o.forEach((e=>{let t=e.querySelector("link").innerHTML;t||(t=e.querySelector("link").getAttribute("href")),t&&!t.match(/ /)||(t=e.querySelector("content").innerHTML.replace(/.*\[link\]/,"").replace(/a href="/,"").replace(/"&gt;.*/,"").replace(/.*&lt;/,"")),t.match(/^http/)||(t=t.replace(/.*\[CDATA\[/,"")),t=t.replace(/^http:/,"https:");let n=e.querySelector("title").innerHTML;n=n.replace(/^\<\!\[CDATA\[/,""),n=n.replace(/\]\].*\>/,"").trim(),a.push({title:n,link:t})})),a}async render(e,t){let n="",r=UI.icons.iconBase+"/noun_189137.svg";r=`<img src="${r}" style="width:1em;height:1em;display:inline-block; padding-left:0.4em;opacity:0.5">`;for(let e of await this.fetchAndParse(t.href||t.link,t.proxy))"window"===t.displayTarget||(n+=`\n          <li about="${e.link}" typeof="rss:item" style="display:none;background:green;border:1px solid grey;">\n            <a href="${t.proxy+e.link}" property="rss:title" style="background:#999;display:inline-block">\n               ${e.title}\n            </a>\n            <a href="${e.link}" class="skipMunge" target="_BLANK" class="external">${r}</a>\n          </li>\n        `);const l=document.createElement("DIV");l.property="xmlns:rss",l.content="http://purl.org/rss/1.0/",t.standAlone?(l.innerHTML=`\n        <div about="${t.href}" typeof="rss:channel">\n          <b property="rss:title">${t.label}</b>\n          <ul typeof="rss:items" style="display:table">\n            ${n}\n          </ul>\n        </div>\n    `,l.querySelector("B").style=`padding:1em;padding-right:0;background:${t.selBackground};color:${t.selColor};border:1px solid grey;width:100%;display:inline-block`):(l.innerHTML=`\n        <div about="${t.href}" typeof="rss:channel">\n\x3c!--          <div property="title" style="background:#d0d0d0;padding:1em;">${t.label}</div>--\x3e\n          <ul typeof="rss:items" style="display:table">\n            ${n}\n          </ul>\n        </div>\n    `,l.querySelector("UL").style="padding:0;padding-left:0;list-style:none;margin-top:0;width:100%;"),l.querySelector("UL").style=`padding:0;border:1px solid grey;list-style:none;margin-top:0;width:100%;height:${t.height};overflow-y:auto;`;let o=l.querySelectorAll("A");for(let e of o)e.style="text-decoration:none;";let a=l.querySelectorAll("LI");for(let e of a)e.style="padding:0.5em;border-bottom:1px solid grey";return t.width&&(l.style.width=t.width),l}}function a(e,t){if(!e)return;const n=e.querySelectorAll("A");for(var r of n)r.innerHTML||alert(r),r.classList.contains("skipMunge")||(r.addEventListener("click",(async t=>{t.preventDefault();let n=e.dataset.target,r=t.target.closest(".solid-uic-app");r&&!n&&(n=r.querySelector(".main"));let l=t.target.href||t.target.parentElement.href;displayLink(null,{href:l,needsIframe:!0},n)})),t||(r.style="display:block;text-decoration:none;padding:0.5em; border-bottom:1px solid grey;color:#017698 !important;"));return e}String.prototype.interpolate=function(e){const t=Object.keys(e),n=Object.values(e);return new Function(...t,`return \`${this}\`;`)(...n)},window.toggleMenu=()=>{const e=document.getElementById("column-2");e.style.display||="block","block"===e.style.display?e.style.display="none":e.style.display="block"},window.toggleDarkMode=()=>{const e=document.getElementById("zContainer");e.classList.contains("darkMode")?e.classList.remove("darkMode"):e.classList.add("darkMode")},window.toggleFontSize=()=>{let e=document.body.style.fontSize||"100%";document.body.style.fontSize="100%"===e?"120%":"120%"===e?"140%":"140%"===e?"90%":"100%"},window.displayLink=async function(e,t,n){if(alert("user.js DISPLAY LINK"),"string"==typeof t&&(t={href:t}),t.href=t.href||t.link,t.type=t.type||"Link",t.type=t.type.replace(/http:\/\/www.w3.org\/ns\/ui#/,""),t.popout){let e=await solidUI.processComponent("",t.href);return e.style.display="block",document.body.appendChild(e),e}if(t.type.startsWith("SolidOS"))return solidUI.util.show("SolidOSLink",t.href);let r,l=document.getElementById("mainMain"),i=document.getElementById("suicTabulator");l&&(l.style.display="block"),i&&(i.style.display="none"),n&&!e&&(r=n);let s=e&&e.target?e.target.closest(".solid-uic-app"):null;s&&s.classList.contains("solid-main-app")?r=s.querySelector("#mainMain"):s&&(r=s.querySelector(".main")),r=r||document.body.querySelector(".main")||document.body,r&&(r.innerHTML="");let c=t.content;if(c){let e=document.createElement("SPAN");return c=c.interpolate(solidUI.vars),e.innerHTML=c,r.innerHTML="",r.appendChild(e),await solidUI.initInternal(r)}if("SolidOSLink"!==t.type){if("Feed"===t.type||"Feed"===t.linkType){let e=await(new o).render(solidUI,t);return e=a(e,"noStyle"),r.innerHTML="",r.appendChild(e),r}if("TransformLink"===t.type){if(t.href&&t.format&&t.format.match(/markdown/))return async function(e,t){let n=await fetch(e.href);n=await n.text(),t.innerHTML="";let r=document.createElement("SPAN");return r.innerHTML="\n<style>\n  h1 {display:none;}\n//  a{text-decoration:none; padding-top:0.25em;display:inline-block;padding-left:1em;}\n  ul {list-style:none;padding-left:0;margin-top:0;}\n</style>"+marked.parse(n),r=a(r,"noStyle"),r}(t,r)}else{if("Link"!==t.type){if(c=await solidUI.processComponent("",t),t.format||(c=a(c)),r.innerHTML="","string"==typeof c){let e=document.createElement("DIV");e.innerHTML=c,r.appendChild(e)}else r.appendChild(c);return r}if(c)return r.innerHTML=c,await this.initInternal(r);if(t.script){let e=await Function('"use strict";return ('+t.script+")")();return e=a(e),e}if(t.href){let e=await async function(e,t,n){let r=e.href;const l=document.createElement("IFRAME");if(l.style="width:100%;height:90vh;border:none;margin:0;padding:0;",l.src="",n)l.src=r;else try{let e=await fetch(r);if(e){e=await e.text(),t.innerHTML="",r=r.replace(/^.*proxy\?uri=/,""),r=new URL(r);const n=`<base href="${r.origin}/"><base target="_BLANK">`;l.srcdoc=`<body>${n}${e}</body>`,l.scrollTo({top:0,behavior:"smooth"})}else console.log("Fetched but no content!")}catch(e){console.log("Couldn't fetch!",e)}return l}(t,r,t.nativeIframe);return r.appendChild(e),r}}}};class i{async sparqlQuery(e,t,n){return"undefined"!=typeof Comunica?await this.comunicaQuery(e,t,n):await this.rdflibQuery(e,t,n)}async rdflibQuery(e,t,n){const r=UI.rdf.graph();UI.rdf.fetcher(r),await r.fetcher.load(e);try{const e=await UI.rdf.SPARQLToQuery(t,!1,r);let n=e.vars.map((e=>e.label)),l=[],o=r.querySync(e);for(let e of o){let t={};for(let r of n){let n=e["?"+r];t[r]=n?n.value:""}l.push(t)}return l=l.sort(((e,t)=>e.label>t.label?1:-1)),l}catch(e){console.log(e)}}async comunicaQuery(e,t,n){try{let r,l=Comunica.newEngine();function o(e){return e?e.replace(/^"/,"").replace(/"[^"]*$/,""):""}n&&l.invalidateHttpCache();let a=await UI.store.fetcher.webOperation("GET",e);if(!a.ok)return void alert(a.statusText);try{r=await l.query(t,{sources:[e]})}catch(e){return void alert(e)}let i=r.variables;r=await r.bindings();let s=[];for(let e of r.entries()){if(!e[1]||!e[1]._root||!e[1]._root.entries)continue;e=e[1]._root.entries;let t={};for(let n in e){let r=o(e[n][0].replace(/^\?/,""));t[r]=t[r]||"";let l=o(e[n][1].id);"ARRAY"!=typeof t[r]&&(t[r]=[t[r]]),"ARRAY"==typeof t[r]?t[r].push(l):t[r]=l}for(let e of i)e=e.replace(/^\?/,""),t[e]=t[e]||"";s.push(t)}return s.length||console.log("No results!"),s}catch(e){console.log(e)}}flatten(e,t){const n={};for(let r of e){let e=r[t];n[e]||(n[e]={});for(let t of Object.keys(r))n[e][t]?n[e][t].includes(r[t])||("object"!=typeof n[e][t]&&(n[e][t]=[n[e][t]]),n[e][t].push(r[t])):n[e][t]=r[t]}e=[];for(let t of Object.keys(n))e.push(n[t]);return e}}class s{render(e){let t=e.parts;if(!t||!t.length)return console.log("No results!"),document.createElement("SPAN");e.sortOn&&(t=t.reverse());let n=document.createElement("TABLE"),r=Object.keys(t[0]),l=document.createElement("TR");for(let t of r){let n=document.createElement("TH");n.innerHTML=t,n.style.border="1px solid black",n.style.padding="0.5em",n.style.background=e.unselBackground,n.style.color=e.unselColor,l.appendChild(n)}n.appendChild(l);for(let l of t){let t=document.createElement("TR");for(let n of r){e.cleanNodes&&(l[n]=l[n].replace(/.*\#/,"").replace(/.*\//,""));let r=document.createElement("TD");r.innerHTML=l[n],r.style.border="1px solid black",r.style.padding="0.5em",r.style.backgroundColor=e.background,r.style.color=e.color,t.appendChild(r)}n.appendChild(t)}return n.style.borderCollapse="collapse",n}}class c{async fromURL(e){let n=UI.rdf.sym(e);return await UI.fetcher.load(n),await this.render({form:e,formSubject:t.getProperty(n,"ui:formSubject"),script:t.getProperty(n,"ui:script"),resultDocument:t.getProperty(n,"ui:formResultDocument")})}async render(e){const t=e.dom||document,n=document.createElement("DIV");n.classList.add("uic-form");let r,l=UI.rdf.sym(e.form);if(e.formSubject&&(r=UI.rdf.sym(e.formSubject)),e.formString?UI.rdf.parse(string,UI.store,e.form,"text/turtle"):await UI.store.fetcher.load(e.form),!r){let e=UI.rdf.sym("http://www.w3.org/ns/ui#formSubject");r=UI.store.any(l,e)}if(e.forceReload&&r&&r.doc&&UI.store.removeDocument(r.doc()),!r)return n.innerHTML="ERROR : Could not load form subject ",n;await UI.store.fetcher.load(r.doc()),document.createElement("H2");let o=e.formResultDocument;r&&!o&&r.doc&&(o=r.doc());const a=e.script||function(){UI.store.fetcher.putBack(r)};try{UI.widgets.appendForm(t,n,{},r,l,o,a)}catch(e){n.innerHTML="FORM ERROR:"+e}return n}}class d{constructor(){this.UIO=UI.rdf.Namespace("http://www.w3.org/ns/ui#"),this.ISA=UI.rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.PIM=UI.rdf.Namespace("http://www.w3.org/ns/pim/space#")}removeClass(e,t){document.querySelector(e).classList.remove(t)}addClass(e,t){document.querySelector(e).classList.add(t)}newElement(e,t,n,r){let l=document.createElement(e);return t&&(l.id=t),n&&(l.classList=n),r&&(l.value=r),l}getProperty(e,t){let[n,r]=t.split(/:/);return UI.store.any(e,UI.ns[n](r))||""}getProperties(e,t){let[n,r]=t.split(/:/);return UI.store.each(e,UI.ns[n](r))||[]}getValues(e,t){let n=[],r=this.getProperties(e,t)||[];for(let e of r)n.push(e.value);return n}getObjects(e,t){return UI.store.each(e,t).map((e=>e.value))}getObject(e,t){let n=UI.store.any(e,t);return n&&n.value?n.value:""}menuize(e){if(!(e=document.querySelector(e)))return;let t=e.querySelectorAll("BUTTON");for(let e of t)e.addEventListener("click",(n=>{n.target;for(let e of t)e.classList.remove("selected");e.classList.add("selected")}))}findType(e,t){if(e||"undefined"==typeof sourceFile||(e=sourceFile),!e)return"unknown";let n=e.replace(/\#.*/,"").replace(/\?.*/,"").replace(/.*\./,"");return n?n.match(/(md)|(markdown)/)?"markdown":n.match(/(dot)|(gv)/)?"graphviz":n.match(/(ttl)|(rdf)|(n3)/)?"rdf":n.match(/(html)|(css)|(js)/)?n:"unknown":"unknown"}async show(e,t,n,r,l,o){return solidUI.hideTabulator&&solidUI.hideTabulator(),(e=e?e.replace(/.*\//,""):null)&&e.match(/html/)||(e="rdf"),await this._show[e](t,n,r,l,o)}_show={image:async(e,t,n)=>{if(n)return this.showIframeSrc(e,n)},pdf:async(e,t,n)=>{if(n)return this.showIframeSrc(e,n)},video:async(e,t,n)=>{if(n)return this.showIframeSrcDoc('<video controls="yes" src="'+e+'" style="max-width:100vw;max-height:100vh"></video>',e,n)},audio:async(e,t,n)=>{if(n)return this.showIframeSrcDoc('<audio controls="yes" src="'+e+'" style="margin-top:2em;"></audio>',e,n)},text:async(e,t,n)=>{if(t||=(await this.loadFile(e)).body,n)return this.showIframeSrcDoc(t,e,n);let r=document.createElement("DIV");return r.innerHTML=t,r},html:async(e,t,n)=>{if(t||=(await this.loadFile(e)).body,n)return this.showIframeSrcDoc(t,e,n);let r=document.createElement("DIV");return r.innerHTML=t,r},graphviz:async(e,t,n)=>{if(t||=(await this.loadFile(e)).body,!n){let e=document.createElement("DIV");try{d3.select(e).graphviz().renderDot(t,(()=>{}))}catch(e){alert(e)}return e}document.querySelector(n).innerHTML="";try{d3.select(n).graphviz().renderDot(t,(()=>{}))}catch(e){alert(e)}},markdown:async(e,t,n)=>{t||=(await this.loadFile(e)).body;let r=marked.parse(t);if(n)return this.showIframeSrcDoc(r,e,n);let l=document.createElement("DIV");return l.innerHTML=r,l},Component:()=>{alert("utils.js Component")},SolidOSLink:async(e,t,n,r,l)=>{e||=l.href,solidUI.showTabulator&&solidUI.showTabulator();let o=document.getElementById("suicTabulator")||n;o&&(o.style.display="block");let a=o?o.querySelector("#outline")||o.querySelector(".outline"):null;a||(o=function(){let e=document.createElement("DIV");e.classList.add("TabulatorOutline");let t=document.createElement("TABLE");return t.classList.add("outline"),e.appendChild(t),e}(),a=o.querySelector(".outline"));let i=UI.rdf.sym(e),s=l&&l.pane?l.pane:null,c=l?l.plugin:"";c||="",l&&l.displayTarget,c.match(/ProfileEditor/)&&(s="editProfile"),c.match(/PreferencesEditor/)&&(s="basicPreferences"),s=s?panes.byName(s):null;const d=new URLSearchParams(location.search);return e=e.uri?e.uri:e,d.set("uri",e),window.outliner.GotoSubject(i,!0,s,!0,null,a),a},Form:async(e,t,n)=>{let r=e.doc?e.doc():e;r.value&&(r=r.value);const l=await(await new c).render({form:e.value});return t&&(t.startsWith("#")||(t="#"+t),document.querySelector(t).innerHTML="",document.querySelector(t).appendChild(l)),l},SparqlQuery:async(e,t,n)=>{let r=(UI.store.any(e,this.UIO("endpoint"),null)||"").value,l=(UI.store.any(e,this.UIO("query"),null)||"").value;l=l.replace(/\$\{[^\}]*\}/g,"");let o=(new s).render({parts:await(new i).sparqlQuery(r,l,n),cleanNodes:!0,sortOn:"term"});return t&&(document.querySelector(t).innerHTML="",document.querySelector(t).appendChild(o)),o},DataTemplate:async(e,t,n)=>{n||=UI.store;let r=this.getUIterm(e,"query"),l=this.getUIterm(e,"endpoint"),o=this.getUIterm(e,"template"),a=await(new i).sparqlQuery(l,r,n),s="";for(let e of a.reverse())s+=o.interpolate(e);t&&this.showIframeSrcDoc(s,e,t);let c=document.createElement("DIV");return c.innerHTML=s,c},PageDefinition:async(e,t)=>{e=this.getMainSubject(e);let n=new DOMParser,r=new XMLSerializer,l=this.getUIterm(e,"pageTemplate"),o=await this.loadFile(l),a=n.parseFromString(o.body,"text/html"),i=UI.store.match(e,this.UIO("component"));for(let e of i){let t,n;e=e.object,t=this.getObject(e,this.UIO("label")),n=this.getObject(e,this.UIO("href"));let r=this.fileInfo(n);r&&t&&a.querySelector("#"+t).appendChild(await this.show(r.contentType,n))}return a=r.serializeToString(a),t&&await this.showIframeSrcDoc(a,url,t),a},rdf:async(e,t,n,r,l)=>{if(l.dataSourceType)return await this._show[l.dataSourceType](e,t,n,r,l);try{let o=UI.rdf.sym(e.match(/\#/)?e:e+"#this");await this.crossLoad(e,t,r);let a=this.getUItype(o);return a&&a.match(/(Form)/)?await this._show[a](o,n,r):await this._show.SolidOSLink(UI.rdf.sym(e),n,r,l)}catch(e){return alert(e),e}}};mungeHash(e){return UI.rdf.sym(e.match(/\#/)?e:e+"#this")}async dataTemplate2Iframe(e,t){let n=this.getUIterm(e,"query"),r=this.getUIterm(e,"endpoint"),l=this.getUIterm(e,"template"),o=await(new i).sparqlQuery(r,n,UI.store),a="";for(let e of o.reverse())a+=l.interpolate(e);return this.showIframeSrcDoc(a,e,t),a}async template2Iframe(e,t){let n=this.getUIterm(e,"query");await UI.store.fetcher.load(n);let r=UI.rdf.sym(n+"#this"),l=this.getUIterm(r,"endpoint"),o=this.getUIterm(r,"query"),a=this.getUIterm(e,"before"),s=this.getUIterm(e,"beforeQuery");await UI.store.fetcher.load(s);let c=UI.rdf.sym(s+"#this"),d=this.getUIterm(c,"endpoint"),u=this.getUIterm(c,"query"),p=await(new i).sparqlQuery(d,u,UI.store);a=a.interpolate(p[0]);let y=await(new i).sparqlQuery(l,o,UI.store),h=this.getUIterm(e,"recurring"),m=this.getUIterm(e,"after"),f="";for(let e of y.reverse())f+=h.interpolate(e);let g=a+f+m;return this.showIframeSrcDoc(g,t),g}makeIframe(){let e=document.createElement("IFRAME");return e.style="height:100%;width:100%;border:none",e}show_iframe(e,t){document.querySelector(t).innerHTML="",document.querySelector(t).appendChild(e)}showIframeSrc(e,t){let n=this.makeIframe();if(n.src=e,!t)return n;this.show_iframe(n,t)}showIframeSrcDoc(e,t,n){let r=this.makeIframe();e=e.replace(/X-Frame-Options/g,"");const l=`<base href="${(t=new URL(t)).origin}${t.pathname}">`;r.srcdoc=`<body>${l}${e}</body>`,r.scrollTo({top:0,behavior:"smooth"}),this.show_iframe(r,n)}makeSelector(e,t,n,r,l){let o=document.createElement("SELECT");for(let t of e){let e,n;if("string"==typeof t?e=n=t:(e=t[0],n=t[1]),n=(n||e).replace(/^http:\/\//,"").replace(/^https:\/\//,""),n.endsWith("/")||(n=n.replace(/.*\//,"")),!n||!t)continue;n||="/";let r=document.createElement("OPTION");r.value=r.title=e,r.innerHTML=n,o.appendChild(r)}if(n&&(o.value=n),o.value||=o.childNodes[0].value,o.addEventListener("change",(async e=>{t(e.target.value)})),l&&(o.size=l),r){let e=document.querySelector(r);e.innerHTML="",e.appendChild(o)}return o}getParent(e){return e.replace(/\/$/,"").replace(/\/[^\/]*$/,"/")}fileInfo(e){if(!e)return;let t;"string"!=typeof e&&(e=e.url||e.uri);try{t=new URL(e)}catch(t){return console.log(77,e,t),{}}let n=t.pathname.replace(/.*\//,"").replace(/\.[^\.]*$/,"");n=n===t?"":n;let r,l,o=t.pathname.replace(/.*\//,"").replace(/.*\./,"");o=o===n?"":o,o.match(/(md)|(markdown)/)&&(r="markdown"),o.match(/(dot|gv)/)&&(r="graphviz"),o.match(/(ttl|rdf|n3)/)&&(r="rdf"),o.match(/txt/)&&(r="text",l="text/plain"),o.match(/(html)|(css)|(js)/)&&(r=o),o.match(/(gif|jpg|jpeg)/)&&(r=o),r||="unknown";let a=t.pathname.replace(/[^\/]*$/,"");n=decodeURI(n);let i=!n&&a.endsWith("/");return l="unknown",i?l="text/turtle":window.mime&&(l=window.mime.getType(e)),{url:e,file:n,path:a,ext:o,label:(n||a)+(o?"."+o:""),editable:l&&!l.match(/(image|video|audio|unknown)/),type:r,contentType:l,host:t.origin+"/",isHidden:!!e.match(/\/\./),isContainer:i}}async crossLoad(e,t,n){t?UI.rdf.parse(t,UI.store,e,"text/turtle"):await UI.store.fetcher.load(e);let r=this.fileInfo(e);return r.contentType="text/turtle",r.type="rdf",r.editable=!0,r}async loadFile(e){let t=this.fileInfo(e);try{let n=await UI.store.fetcher.webOperation("GET",e,{credentials:"omit"});return n.ok?(t.contentType=n.headers.get("Content-Type"),t.editable=!t.contentType.match(/(image|video|audio|pdf|unknown)/),t.body=n.responseText,t.ok=n.ok):alert("utils.loadFile() "+n.status),t}catch(e){return alert("network loadFile() "+e),t}}getUItype(e){e=this.getMainSubject(e);let t=UI.store.each(e,this.ISA,null);for(let e of t)if(e.value.match(/ui\#/))return e.value.replace(/.*\#/,"")}getUIterm(e,t){e=this.getMainSubject(e);let n=UI.store.each(e,this.UIO(t)),r=[];if(n&&n[0]&&"Collection"===n[0].termType){for(let e of n[0].elements)r.push(UI.store.match(e));return r}return n[0]?n[0].value:n}getMainSubject(e){e=(e=e.uri?e.uri:e).match(/\#/)?e:e+"#this";try{return UI.rdf.sym(e)}catch(e){console.log(e)}}mungeLabel=e=>e?"Literal"===e.termType?`"${e}"`:("type"===(e=e.value.replace(/.*\#/,"").replace(/.*\//,""))&&(e="a"),e):"";mungeURL=e=>{let t=document.getElementById(e).value;return t.startsWith("http")||(t=window.location.href.replace("index.html","")+t),t};PUT=async(e,t,n)=>{e=e.replace(/\#[^\#]*$/,"");try{return await UI.store.fetcher.webOperation("PUT",e,{contentType:n,body:t})}catch(e){return e}}}String.prototype.interpolate=function(e){const t=Object.keys(e),n=Object.values(e);return new Function(...t,`return \`${this}\`;`)(...n)};class u{async makeFeedSelector(e,t,n){self=this,self.displayArea=n;const r=new d,l=UI.rdf.Namespace("http://www.w3.org/ns/ui#"),o=UI.rdf.Namespace("http://www.w3.org/2004/02/skos/core#"),a=UI.rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");let i=document.body;await r.crossLoad(e),e=UI.rdf.sym(e);let s=UI.store.each(null,a("type"),l("FeedTopic")),c=[];for(let e of s)c.push([e.value,UI.store.any(e,l("label")).value]);let u=r.makeSelector(c,(async e=>{await y(e)}),null,null,3);if(u.id="topicSelector",t){i="string"==typeof t?document.querySelector(t):t,i.innerHTML="";let e=r.newElement("DIV","collectionHolder"),n=r.newElement("DIV","itemSelector");i.appendChild(u),i.appendChild(e),i.appendChild(n),await y(c[0][0],i)}let p=i.querySelectorAll("#feedMenu select");for(let e of p)e.style="display:block; width:100%;  padding:0.5rem; margin-bottom:1rem; border-radious:0.02rem;";async function y(e,t){"string"==typeof e&&(e=UI.rdf.sym(e)),await r.crossLoad(e);let n=UI.store.each(null,o("broader"),e),a=[];for(let e of n){let t=UI.store.any(e,l("href")).value,n=UI.store.any(e,l("label")).value;a.push([t,n])}let i=await r.makeSelector(a,(async e=>{await h(e)}),null,null,7);i.id="collectionSelector";let s=(t||document).querySelector("#collectionHolder");s.innerHTML="",s.appendChild(i);let c=s.querySelectorAll("#feedMenu select");for(let e of c)e.style="display:block; width:100%;  padding:0.5rem; margin-bottom:1rem; border-radious:0.02rem;";await h(a[0][0])}async function h(e){let t=document.getElementById("itemSelector");t.innerHTML="",t.appendChild(await self.items2list({href:e}))}}async fetchAndParse(e,t){e=(t=void 0===t?"https://solidcommunity.net/proxy?uri=":t)+encodeURI(e);let n=await fetch(e),r=await n.text(),l=(new window.DOMParser).parseFromString(r,"text/xml"),o=l.querySelectorAll("item")||null;o=o.length<1?l.querySelectorAll("entry"):o;let a=[];return o.forEach((e=>{let t=e.querySelector("link").innerHTML;t||(t=e.querySelector("link").getAttribute("href")),t&&!t.match(/ /)||(t=e.querySelector("content").innerHTML.replace(/.*\[link\]/,"").replace(/a href="/,"").replace(/"&gt;.*/,"").replace(/.*&lt;/,"")),t.match(/^http/)||(t=t.replace(/.*\[CDATA\[/,"").replace(/\]\]\>$/,"")),t=t.replace(/^http:/,"https:");let n=e.querySelector("title").innerHTML;n=n.replace(/^\<\!\[CDATA\[/,""),n=n.replace(/\]\].*\>/,"").trim(),a.push({title:n,link:t})})),a}async items2list(e,t){document.getElementById("itemSelector").innerHTML="",e.proxy||="https://solidcommunity.net/proxy?uri=";let n="",r=UI.icons.iconBase+"/noun_189137.svg";r=`<img src="${r}" style="width:1em;height:1em;display:inline-block; padding-left:0.4em;opacity:1">`;for(let t of await this.fetchAndParse(e.href||e.link,e.proxy))"window"===e.displayTarget||(n+=`\n          <li about="${t.link}" typeof="rss:item" style="display:none;background:green;border:1px solid grey;">\n            <a href="${e.proxy+t.link}" target="#display" property="rss:title" style="background:#999;display:inline-block">\n               ${t.title}\n            </a>\n            <a href="${t.link}" class="skipMunge" target="_BLANK" class="external">${r}</a>\n          </li>\n        `);const l=document.createElement("DIV");l.property="xmlns:rss",l.content="http://purl.org/rss/1.0/",e.standAlone?(l.innerHTML=`\n        <div about="${e.href}" typeof="rss:channel">\n          <b property="rss:title">${e.label}</b>\n          <ul typeof="rss:items" style="display:table">\n            ${n}\n          </ul>\n        </div>\n    `,l.querySelector("B").style=`padding:1em;padding-right:0;background:${e.selBackground};color:${e.selColor};border:1px solid grey;width:100%;display:inline-block`):(l.innerHTML=`\n        <div about="${e.href}" typeof="rss:channel">\n\x3c!--          <div property="title" style="background:#d0d0d0;padding:1em;">${e.label}</div>--\x3e\n          <ul typeof="rss:items" style="display:table">\n            ${n}\n          </ul>\n        </div>\n    `,l.querySelector("UL").style="padding:0;padding-left:0;list-style:none;margin-top:0;width:100%;"),l.querySelector("UL").style=`padding:0;border:1px solid grey;list-style:none;margin-top:0;width:100%;height:${e.height};overflow-y:auto;`;let o=l.querySelectorAll("A");for(let e of o)e.style="text-decoration:none;",e.onclick=async e=>{if(e.target.parentNode.classList.contains("skipMunge"))return;e.preventDefault();let t=document.createElement("IFRAME");t.style="height:100%;width:100%;border:none";let n=e.target.href,r=await window.fetch(n),l=await r.text();l=l.replace(/X-Frame-Options/g,""),n=n.replace(/^.*proxy\?uri=/,""),n=new URL(n);const o=`<base href="${n.origin}/"><base target="_BLANK"><style>body{background:white !important}</style>`;t.srcdoc=`<body>${o}${l}</body>`,t.scrollTo({top:0,behavior:"smooth"});let a=document.querySelector(self.displayArea);a.innerHTML="",a.appendChild(t)};let a=l.querySelectorAll("LI");for(let e of a)e.style="padding:0.5em;border-bottom:1px solid grey";return e.width&&(l.style.width=e.width),l}}!async function(){let e=document.querySelectorAll("[data-suicFeedMenu]");for(let t of e){let e=t.dataset.suicfeedmenu;e.startsWith("/")&&(e=window.origin+e);let n=t.dataset.display,r="#"+t.id;const l=new u;await l.makeFeedSelector(e,r,n)}}();class p{async render(e,t){const n=t.parts,r=e.createElement("DIV","accordion");if(!n||!n.length)return r;for(let l of n){let n=e.createElement("DIV"),o=e.createElement("DIV",""),a=e.createElement("SPAN","",l.label||l.topic);a.style.display="table-cell",a.style.width="100%",o.appendChild(a);let i=e.createElement("SPAN","caret-down","⌄");i.style.display="table-cell",i.textAlign="right",o.appendChild(i),o.style.backgroundColor=t.unselBackground,o.style.color=t.unselColor,o.style.padding="0.75em",o.style.border="1px solid grey",o.style.cursor="pointer";let s=e.createElement("DIV");if(l.content)s.innerHTML=l.content;else{console.log(t);for(let t=0;t<l.linkLabel.length;t++){let n=l.linkLabel[t],r=l.linkUrl[t],o=e.createElement("BUTTON","",n);o.setAttribute("data-link",r),o.style.width="100%",o.style.border="none",o.style.background="transparent",o.style.marginBottom="0.25em",o.style.cursor="pointer",o.onclick=e=>{showByClass(e)},s.appendChild(o)}}s.style.padding="0.75em",s.style.border="1px solid grey",s.style.borderTop="none",s.style.display="none",o.onclick=e=>{let t="block"===s.style.display,n=r.children;for(let e of n)e.children[1].style.display="none";s.style.display=t?"none":"block"},s.style.backgroundColor=t.background,s.style.color=t.color,n.appendChild(o),n.appendChild(s),n.style.marginBottom="1em",r.appendChild(n)}return e.simulateClick(r.querySelector("DIV DIV DIV")),await e.initInternal(r)}}class y{async render(e,t){function n(e){let t=function(){let e=document.createElement("DIV");e.style="height:1rem",document.body.appendChild(e);let t=e.clientHeight;return document.body.removeChild(e),t}();return e.menuHeight=2*t,e.headerHeight=6*t,window.SolidAppContext={scroll:e.headerHeight},e.mainHeight=window.innerHeight-e.headerHeight,e.headerHeight=e.headerHeight.toString()+"px",e.mainHeight=e.mainHeight.toString()+"px",e}(t=e.setDefaults(t)).fullPage&&(window.addEventListener("resize",(()=>{t=n(t);let e=document.getElementById("mainMain"),r=document.getElementById("suicTabulator");e&&(e.style.height=t.mainHeight),r&&(r.style.height=t.mainHeight)})),document.body.style.overflow="hidden"),t=n(t),t.logo||="",t.title||="",t.headerHeight=t.logo||t.title||t.adminMenu?t.headerHeight:"0",t.leftMenu="",t.siteMenu="","horizontal"===t.orientation?t.leftMenuStyle="display:none":t.leftMenuStyle=`\n        display:block;\n        width:36vw !important;\n        height:${t.mainHeight};\n        overflow-y:scroll;\n        margin:0;\n        padding:0;\n      `;let r=await this.getHTML(t),o=e.createElement("SPAN","",r),a=o.querySelector("#solidLogo");a&&(a.src="https://solidproject.org/assets/img/solid-emblem.svg");let i=o.querySelector("#currentPodMenu");"vertical"===t.orientation&&(i=o.querySelector("NAV"));const s=await e.processComponent(i,t.currentPodMenu);if(s&&i&&i.appendChild(s),t.userMenu){const n=await e.processComponent(i,t.userMenu);let r=o.querySelector("#userMenu");r&&r.appendChild(n)}if(t.loginBox&&await async function(e){const t=e.querySelector("#loginArea"),n=panes.UI;async function r(e){await async function(){n.authn.currentUser()||await n.authn.checkUser()}(),t.innerHTML="",t.appendChild(n.authn.loginStatusBox(document,null,{}));let r=t.querySelectorAll("input");r[0].value=r[0].value.replace(/WebID\s*/,""),r[1]&&(r[1].style.display="none")}e.querySelector("#suicTabulator"),n.authn.authSession&&(n.authn.authSession.onLogin((()=>{r()})),n.authn.authSession.onLogout((()=>{r()})),n.authn.authSession.onSessionRestore((e=>{r()}))),r()}(o),await l(o),t.initialContent){let n=await e.getComponentHash(t.initialContent);n=n.content.interpolate(e.vars);let r=o.querySelector("#mainMain");r&&(r.innerHTML=n)}return o}rem2vw(e){return e*(100/document.body.clientWidth)}rem2vh(e){return 16*e*(100/window.innerHeight)}async getHTML(e){if(e.leftColumnColumnStyle||="display:none",e.leftColumnColumnMenu||="",e.siteMenu||="",e.leftColumnColumnStyle||="",e.iframeSrc||="",e.iframeContent||="",e.logoStyle="\n             height: 3rem;\n            display: inline-block;\n       padding-left: 0.5rem;\n     ",e.titleStyle='\n       display:inline-block;\n       vertical-align:top; align:left;\n       font-size: 2rem;\n       padding-top: 0.4rem;\n       padding-left:1rem;"\n     ',e.appStye="\n              display: flex;\n       flex-direction: column;\n                width: 100%;\n               height: 100%;\n     ",e.mainStyle=`\n        padding:0rem;\n        width:100%;\n        overflow:scroll;\n        position:absolute;\n        top:${e.headerHeight} !important;\n        left:0;\n        height:${e.mainHeight};\n     `,e.theme)try{let t=await window.fetch(e.theme),n=await t.text();return n=solidUI.fillTemplate(n,[e]),await n}catch(e){console.log(e)}return""}}class h{async render(e,t,n){"string"==typeof t&&(t=await e.processComponent(n,t));let r=e.createElement("NAV","solid-uic-dropdown-menu"),l=document.createElement("UL"),o=document.createElement("DIV");for(var a of(r.style.background=t.unselBackground,r.style.color=t.unselColor,o.style.width="100%",o.style.backgroundColor=t.background,o.style.color=t.color,o.innerHTML="",o.classList.add("main"),r.appendChild(l),t.parts))l.appendChild(await this.renderMenuItem(a,t,o));const i=e.createElement("SPAN");return r.style.display="inline-block",r.style.textAlign=t.position,l.style.textAlign=t.position,i.appendChild(r),i.appendChild(o),i}async renderMenuItem(e,t,n){if(e.menu&&e.menu.type&&"SparqlQuery"===e.menu.type){let t=await solidUI.processComponent(null,null,e.menu);"object"==typeof t&&(e.parts=t)}const r=document.createElement("LI"),l=document.createElement("SPAN");if(l.innerHTML=e.label,r.appendChild(l),r.style.cursor="pointer",r.style.display="inline-block",r.style.backgroundColor=t.unselBackground,r.style.color=t.unselColor,r.onmouseover=()=>{r.style.backgroundColor=t.selBackground,r.style.color=t.selColor},r.onmouseout=()=>{r.style.backgroundColor=t.unselBackground,r.style.color=t.unselColor},e.popout||!e.parts)r.classList.add("item"),r.name=e.href,r.onclick=t=>{e.href=t.target.parentElement.name,window.displayLink(t,e,n)};else{r.classList.add("caret");let l=document.createElement("UL");for(var o in r.appendChild(l),l.classList.add("nested"),e.parts){let r=e.parts[o];"object"==typeof r&&(r.target=t.target),l.appendChild(await this.renderMenuItem(r,t,n))}}return r}}class m{async render(e,t){let n=e.dom||document,r=document.createElement("SPAN");e.targetSelector&&(r=n.querySelector(e.targetSelector));const l=`\n      background-color:${(s=e).unselBackground};\n      color:${s.unselColor};\n      cursor:pointer;\n    `,o="\n      display: none; /* Hidden by default */\n      position: fixed; /* Stay in place */\n      left: 0;\n      top: 0;\n      width: 100%; /* Full width */\n      overflow: auto; /* Enable scroll if needed */\n      background-color: rgb(0,0,0); /* Fallback color */\n      background-color: rgba(0,0,0,0.8); /* Black w/ opacity */\n      height: 100%; /* Full height */\n      z-index:20000;\n    ",a=`\n      background-color: #fefefe;\n      margin: 5% auto; /* 15% from the top and centered */\n      padding: 1rem;\n      border: 1px solid #888;\n      border-radius:0.5rem;\n      width: ${s.width};\n      height: ${s.height};\n    `,i="\n      color:red;\n      text-align:right;\n      margin-bottom: 0.25rem;\n      font-size: 2rem;\n      font-weight: bold;\n      cursor:pointer;\n    ";var s;return e.iframe&&(document.createElement("IFRAME"),e.content=`<iframe src="${e.iframe}" style="width:100%;height:90%;border:none"></iframe>`),r.innerHTML=`\n      <button style="${l}" onclick="window.openModal(this)">\n        ${e.label}\n      </button>\n      <div style="${o}">\n        <div style="${a}">\n          <div style="${i}" onclick="window.closeModal(this)">\n            &times;\n          </div>\n          ${e.content}\n        </div>\n      </div>\n    `,t?await t.initInternal(r):r}}window.openModal=function(e,t){e.parentElement.children[1].style.display="block"},window.closeModal=function(e,t){e.parentElement.parentElement.style.display="none"};class f{render(e){const t=document.createElement("SPAN");t.classList.add("solid-ui-component"),t.style="display:flex;flex-direction:row;width:100%;height:${j.height}";const n=document.createElement("DIV");n.style="margin-top:0; width:30vw;height:91vh;margin-top:0; min-height:min-content";const r=document.createElement("DIV");r.style="flex-grow:1;height:{j.height};max-height:100vh;",r.classList.add("main"),r.style.background="ffe";let l=document.createElement("DIV");l.style="width:30vw;border:1px solid grey;border-bottom:none",l.style.background=e.unselBackground,l.style.color=e.unselColor,e.parts||=e.dataSource.parts;const o=e.label||e.parts[0].label||e.parts[0];l.innerHTML=`\n       <div style="border-bottom:1px solid grey; padding:0.5em;cursor:pointer;">\n        <span style="display:table-cell;width:100%">${o}</span><span style="display:table-cell;font-size:large;width:100%;text-align:right;">⌄</span>\n       </div>\n    `;let a=document.createElement("DIV");a.style="width:30vw;border:1px solid grey;border-top:none;display:none",l.querySelector("div").onclick=()=>{a.style.display||="block","block"===a.style.display?a.style.display="none":a.style.display="block"};for(let t of e.parts)a.innerHTML+=`\n         <a href="${t.link}" style="text-decoration:none;display:block;border-bottom:1px solid grey; padding:0.5em;" data-link="${t.link}" data-type="${t.type}">\n          ${t.label}\n         </a>\n      `;for(let e of a.querySelectorAll("A"))e.onclick=e=>{e.preventDefault();let t=e.target,n={href:t.href,type:t.dataset.type,target:r};return t.parentElement.style.display="none",l.querySelector("DIV SPAN").innerHTML=t.innerHTML,i.style.display="block",i.style.width="30vw",displayLink(null,n,i),!1};let i=document.createElement("DIV");return i.style="height:100%;border:1px solid grey;overflow-y:scroll;width:30vw;",n.appendChild(l),n.appendChild(a),n.appendChild(i),t.appendChild(n),t.appendChild(r),t}}class g{async render(e,t){const n=t.parts,r=e.createElement("DIV","solid-uic-tabs");t.style&&(r.style=t.style);const l=e.createElement("NAV");"vertical"===t.orientation?l.style.textAlign="right":l.style.textAlign=t.position;let o=e.createElement("DIV");o.style.backgroundColor=t.background,o.style.color=t.color;let a=0;for(let i of n){a++;let n=e.createElement("BUTTON",a,i.label);n.style.backgroundColor=t.unselBackground,n.style.color=t.unselColor,n.style.padding="0.75em",n.style.border="1px solid grey",n.style.cursor="pointer";let s=e.createElement("DIV",a,i.content);if(s.style.padding="0.75em","horizontal"===t.orientation&&(s.style.border="1px solid grey"),s.style.display="none","SolidOSLink"===i.type){let e=`tab-${a}-outline`;s.innerHTML=`\n          <div class="TabulatorOutline" id="${e}-tabulator" role="main">\n            <table id="${e}"></table>\n            <div id="GlobalDashboard"></div>\n          </div>\n        `;let t=window.kb.sym(i.href),n=s.querySelector("#"+e);n.style="display:table-row;background-color:c0c0c0",window.outliner.GotoSubject(t,!0,void 0,!0,void 0,n)}n.onclick=e=>{e.preventDefault();let o=r.querySelector("DIV").children;for(let e of o)e.style.display="none";for(let e of l.children)e.style.backgroundColor=t.unselBackground,e.style.color=t.unselColor;n.style.backgroundColor=t.selBackground,n.style.color=t.selColor,s.style.display="block"},l.appendChild(n),o.appendChild(s),"vertical"===t.orientation?(n.style.display="block",n.style.marginBottom="0.5em",n.style.width="100%",r.style.width="100%",r.style.height="100%",r.style.display="table-row",l.style.display="table-cell",o.style.display="table-cell",o.style.display="block",o.style.height="100%",s.style.height="100%"):(n.style.marginRight="0.5em",n.style.borderBottom="none")}r.appendChild(l);const i=document.createElement("SPAN");return i.style="\n        color:red;\n        text-align:right;\n        position:absolute;\n        top:0.25rem;\n        right:0.25rem;\n        font-size: 2rem;\n        font-weight: bold;\n        cursor:pointer\n      ",i.addEventListener("click",(e=>{e.preventDefault(),e.target.parentElement.style.display="none"})),i.innerHTML="&times",r.appendChild(i),r.appendChild(o),e.simulateClick(r.querySelector("BUTTON")),await e.initInternal(r)}}class w{constructor(){this.store=UI.rdf.graph(),this.fetcher=UI.rdf.fetcher(this.store)}async init(){for(let e of document.getElementsByClassName("ocb")){let t=e.dataset.component;this.bookmarksDisplay=e.dataset.display;try{t=await this.loadUnlessLoaded(t),e=e.appendChild(document.createElement("UL")),await this.getTopic(t,e,this.bookmarksDisplay,"start"),document.getElementById("ocbStart").click()}catch(e){alert(e)}}}async getTopic(e,t,n,r){const l=this;"string"==typeof t&&(t=document.querySelector(t)),n||=t.dataset.display,this.bookmarksDisplay||=n;let o=UI.rdf.Namespace("http://www.w3.org/2002/01/bookmark#");const a=UI.rdf.Namespace("http://www.w3.org/2000/01/rdf-schema#"),i=UI.rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),s=UI.rdf.Namespace("http://www.w3.org/ns/ui#");e=await this.loadUnlessLoaded(e);let c=this.store.any(e,a("label"),null,e.doc());c=void 0===c?"???":c.value;let d=document.createElement("SPAN");d.appendChild(document.createTextNode(c)),d.classList.add("caret"),d.addEventListener("click",(function(){let e=this.parentElement.querySelector(".nested");e&&e.classList.toggle("active"),this.classList.toggle("caret-down")}));let u=document.createElement("LI");r&&(d.id="ocbStart"),u.appendChild(d),t.appendChild(u);let p=this.store.each(null,o("subTopicOf"),e);if(p.length>0){let e=document.createElement("UL");e.classList.add("nested"),u.appendChild(e);for(let t in p)this.getTopic(p[t],e)}else{let t=this.store.each(null,o("hasTopic"),e),n=document.createElement("UL");n.classList.add("nested");for(let r in t){let c=t[r],d=this.store.any(c,a("label"),null,e.doc()),u=this.store.match(c,i("type"),s("Feed")).length;d=d?d.value:"???";let p=this.store.any(c,o("recalls"),null,e.doc()),y=document.createElement("LI");u?y.classList.add("caret"):y.classList.add("item"),u?y.addEventListener("click",(async function(){alert("Feed Me!")})):y.addEventListener("click",(async function(){document.querySelector(l.bookmarksDisplay).innerHTML=`<iframe src="${p.uri}"></iframe>`})),y.appendChild(document.createTextNode(d));let h=document.createElement("DIV");h.classList.add("closed"),y.appendChild(h),n.appendChild(y)}u.appendChild(n)}}async loadUnlessLoaded(e){try{const t=document.location.href.replace(/\/[^\/]*$/,"/");if(e=(e="string"==typeof e?e:e.uri).match("//")?e:t+e,"BlankNode"===(e=UI.rdf.sym(e)).termType)return e;this.store.any(null,null,null,e.doc())||await this.fetcher.load(e)}catch(e){alert(e)}return e}}async function b(e){let t=e.dataSource,n=e.contentArea,r=e.collectionSize||6,l=e.resourceSize||12;const o=UI.rdf.Namespace("http://www.w3.org/ns/ldp#");if(!t)return"";let a=t.replace(/\/[^\/]*$/,"/"),i=function(e){try{return new URL(e).host}catch(t){return console.log(e,t),e}}(a);const s=UI.rdf.sym(a);await UI.store.fetcher.load(s);let c=UI.store.each(s,o("contains"),null,s),d=[],u=[];u.push({value:s.uri,label:S(s.uri)});for(let e of c.sort()){let t=e.value,n=I(e);k(t)||(t.endsWith("/")?u.push({value:t,label:S(t),contentType:n}):d.push({value:t,label:S(t),contentType:n}))}let p=s.uri.replace(/\/$/,"").replace(/\/[^\/]*$/,"/");p&&(p.endsWith("//")||u.splice(1,0,{value:p,label:"../"})),u=await v(u,(async t=>{let n=t.target.value;return e.dataSource=n,await b(e)}),t,null,r),d=await v(d,(async t=>{await solidUI.showPage(t,e)}),t,null,l),u.classList=["containerSelector"],d&&(d.classList=["resourceSelector"]),n&&"string"==typeof n&&(n=document.querySelector(n));let y=n||document.createElement("DIV"),h=document.createElement("DIV");return h.style="width:100% !important;text-align:right",h.innerHTML=`\n       <span style="text-align:left">${i}</span>\n       <a href="${a}" style="display:inline-block !important;color:gold !important;text-align:right !important;"><img src="https://solidproject.org/assets/img/solid-emblem.svg" style="height:2rem;width:2rem;margin-left:2rem;" /></a>\n    `,h.querySelector("A").addEventListener("click",(t=>{alert(t),t.preventDefault(),solidUI.showPage(t,{link:a,displayArea:e.displayArea})})),y.innerHTML="",h&&y.appendChild(h),u&&y.appendChild(u),d&&y.appendChild(d),y}function I(e){const t=UI.rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type");let n=UI.store.each(e,t).map((e=>e.value));for(let e of n)if(e.match(/http:\/\/www.w3.org\/ns\/iana\/media-types/))return e.replace(/http:\/\/www.w3.org\/ns\/iana\/media-types\//,"").replace(/\#Resource/,"")}function k(e){if(!e)return!0;let t=new URL(e);return t=t.pathname,t=t.endsWith("/")?t.replace(/^\//,""):t.replace(/.*\//,""),!!t.startsWith(".")||!!t.endsWith("~")||void 0}function S(e){try{return new URL(e).pathname}catch(t){return console.log(e,t),e}}function v(e,t,n,r,l){function o(e){return e?((e=decodeURI(e)).endsWith("/")||(e=e.replace(/.*\//,"")),e||"/"):""}function a(e,t){if(Object.keys(e).length>2)for(let n of Object.keys(e))"value"!==n&&"label"!==n&&(t.dataset||={},t.dataset[n]=e[n]);return t}let i=e.length;if(l||=0,(l=i<=l?i:l)<1)return;if(1===l){let n=document.createElement("BUTTON");return n.value=e[0].value,n.innerHTML=o(e[0].label),n.addEventListener("click",(e=>{t(e)})),n}let s=document.createElement("SELECT");for(let t of e){let e,n;if("string"==typeof t?e=n=t:(e=t.value,n=t.label||t.value),!n||!t)continue;n=o(n);let r=document.createElement("OPTION");r.value=e,r.title=e+"\n"+(t.contentType||""),r.dataset||={},r.dataset.contenttype=t.contentType||"",r.innerHTML=n,r.style="padding:0.25em;",r=a(t,r),s.appendChild(r)}if(n&&(s.value=n),s.addEventListener("change",(async e=>{t(e)})),s.size=l,s.style="padding:0.5em;width:100%",r){let e=document.querySelector(r);e.innerHTML="",e.appendChild(s)}return s}async function L(e){let t=e;"object"!=typeof e&&(t=await getFloatComponent(e));let n=function(e){return e.label.replace(/\s+/g,"_")}(t),r=document.getElementById(n);if(r)return void(r.style.display="block");let l,o,a,i,s=document.createElement("DIV"),c=document.createElement("DIV"),d=document.createElement("SPAN"),u=document.createElement("DIV");return u=await async function(e,t){let n;return c.innerHTML=`<span>${e.label}</span>`,e.content?t.innerHTML=e.content:e.dataSource?(n=await solidUI.processComponent(null,e.dataSource),t.appendChild(n)):e.dataSourceType&&(n=await solidUI.util.show(e.dataSourceType,null,null,null,null,e),t.appendChild(n)),t}(t,u),s.id=n,d.innerHTML=" X ",d.style.color="#ffeeee",d.style["font-weight"]="bold",d.style["margin-left"]="2em",d.style.background="#000000",d.style.padding="0.2em;",d.style["border-radius"]||="0.2em",d.addEventListener("click",(e=>{e.target.parentNode.parentNode.style.display="none"})),s.style=t.style||{},s.style.position||="absolute",s.style["z-index"]||=3,s.style.background||="#f1f1f1",s.style.border||="1px solid #d3d3d3",s.style["text-align"]||=":center",c.style=t.headerStyle||{},c.style.padding||="10px",c.style.cursor||="move",c.style["z-index"]||=3,c.style["text-align"]||="center",c.style.background||="#2196F3",c.style.color||="#ffffff",u.style=t.style||{},u.style.padding||="1em",s.onmousedown=e=>{(e=e||window.event).preventDefault(),a=e.clientX,i=e.clientY,document.onmouseup=e=>{document.onmouseup=null,document.onmousemove=null},document.onmousemove=e=>{(e=e||window.event).preventDefault(),l=a-e.clientX,o=i-e.clientY,a=e.clientX,i=e.clientY,s.style.top=s.offsetTop-o+"px",s.style.left=s.offsetLeft-l+"px"}},c.appendChild(d),s.appendChild(c),s.appendChild(u),document.body.appendChild(s),s}const T=new d,C=new i;let U=new class{$rdf=UI.rdf;skos=$rdf.Namespace("http://www.w3.org/2004/02/skos/core#");ui=$rdf.Namespace("http://www.w3.org/ns/ui#");rdf=$rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");constructor(){"undefined"!=typeof panes&&(window.outliner=panes.getOutliner(document))}suic="[data-suic]";async init(){let e=document.querySelectorAll(this.suic);for(let t of e){const e=await this.processComponent(t);e&&t.appendChild(e)}}async initInternal(e){let t=e.querySelectorAll(this.suic);for(let e of t){const t=await this.processComponent(e);e.appendChild(t)}return e}async activateComponent(e,t){t||=document;let n="string"==typeof e?document.querySelector(e):e,r=await this.getComponentHash(n.getAttribute("data-suic"));return r&&r.plugin&&n.setAttribute("data-suicPlugin",r.plugin),0===n.innerHTML.replace(/\s*/g,"").length&&(n=await this.processComponent(n),n&&(n.style||={},n.style.display="block")),n}pluginType(e){return!e||e.match(/(PodBrowser,SolidOS,FeedList,ConceptTree)/)?"builtIn":""}async showPage(e,t,n){let r;console.log("SHOW PAGE"),e&&e.preventDefault&&e.preventDefault(),e||={target:{tagName:""}},e.target.dataset||={},t||={},n||=t;let l=e.href||e.value||t.link||t.data;l||=e.target.value;let o,a=e.target.dataset.suicplugin;if(!a&&e.target.parentElement&&(e.target.parentElement.dataset||={},a=e.target.parentElement.dataset.suicplugin),a&&"built-in"!=this.pluginType(a)){let e=window.origin+`/cm/plugins/${a}.ttl`;await UI.store.fetcher.load(e);let t=UI.rdf.sym(e+"#this"),n=UI.store.match(t,this.rdf("type"),this.ui("LinkHandler"));n&&1===n.length&&(l=UI.store.any(t,this.ui("linkConvert"),null,t.doc()).value.interpolate({href:l}),r="text/html")}if(r||=e.target.dataset.contenttype||T.findType(l),U.showFunction)return await U.showFunction(r,l,t.displayArea,!0,n);if(n.displayTarget&&n.displayTarget.match(/#Draggable/)){let e=(await T.show(r,l,"","",!0,n)).outerHTML;return alert(e),void await L({label:n.label,content:e})}return o=await T.show(r,l,"",t.displayArea,!0,n),o}async processComponent(e,t,n){if(!n){if(!t&&e&&e.dataset){let n=e.dataset.suic;n.startsWith("/")&&(n=window.origin+n),t=await this.loadUnlessLoaded(n)}if(!t)return null;n=await this.getComponentHash(t),e||={},e.dataset||={},e.parentNode||={},e.parentNode.dataset||={},n.displayArea=e.dataset.display||e.parentNode.dataset.display,e.id&&(n.contentArea="#"+e.id),n.contentSource=t.value?t.value:t}if(n||=t,!n.plugin&&e&&e.getAttribute&&(n.plugin=e.getAttribute("data-suicPlugin")||{}),"Component"===n.type){if(n.plugin.match(/#PodBrowser/))return await b(n);if(n.plugin.match(/#SolidOSLink/))return T.show("SolidOSLink",n.href,null,null,null,n);let e=await this.getComponentHash(n.dataSource,n);e.contentSource=n.dataSource,e.contentArea=n.contentArea,e.displayArea=n.displayArea,n=e}if(!n)return void console.log("No ComponentHASH ",t);let r="string"==typeof(n=this.getDefaults(n)).dataSource?await this.getComponentHash(n.dataSource):n.dataSource;if(r&&"string"==typeof r.dataSource&&(r=await this.getComponentHash(r.dataSource)),r&&"Script"===r.type){let e=await Function('"use strict";return('+r.content+")")(),t=document.querySelector(n.contentArea);for(let r of e)r.target=n.displayArea,r.addEventListener("click",(async e=>{e.preventDefault(),r.setAttribute("data-contenttype","text/html"),await T.show("text/html",r.href,null,n.displayArea)})),t.classList.add("suic-anchor-list"),t.appendChild(r)}if(r&&"SparqlQuery"===r.type){let e=r.endpoint,t=r.query.replace(/\$\{[^\}]*\}/g,"");if(n.parts=await this.sparqlQuery(e,t,n),"SparqlQuery"===n.type)return n.parts}if("SparqlQuery"===n.type&&(n.parts=await this.sparqlQuery(n.endpoint,n.query,n),"SparqlQuery"===n.type))return n.parts;if("SolidOSLink"===n.type)return T.show("SolidOSLink",n.href,null,null,null,n);if("AnchorList"===n.type)for(let e of n.content.split(/\n/));if(n.parts&&n.groupOn&&(n.parts=C.flatten(n.parts,n.groupOn),console.log(n.groupOn,n.parts)),"App"===n.type)return await(new y).render(this,n);if(n.type&&n.type.match(/Link/))return await window.displayLink(e,n,e);if(n.type&&n.type.match(/ButtonListMenu/))return await async function(e){let t=document.createElement("DIV");t.id=e.contentSource.replace(/.*\#/,"");for(let n of e.dataSource){n.dataSource||(n=await solidUI.getComponentHash(n));let r=document.createElement("BUTTON");for(let e of Object.keys(n))r.setAttribute(`data-${e}`,n[e]);r.innerHTML=n.label,r.addEventListener("click",(async t=>{t.preventDefault();let l=r.getAttribute("data-link")||r.getAttribute("data-dataSource");await solidUI.showPage(null,{link:l,displayArea:e.displayArea},n)})),t.appendChild(r)}let n=document.querySelector(e.contentArea);return n.innerHTML="",n.appendChild(t),n}(n);if("Menu"===n.type)return await(new h).render(this,n,e);if("MenuOfMenus"===n.type)return await async function(e){let t=document.createElement("DIV");t.id=e.contentSource.replace(/.*\#/,"");let n="";for(let t of e.dataSource){let e=t.directDisplay?t.dataSource:t.id;t.directDisplay||="",n+=`<button about="${e}" data-directDisplay="${t.directDisplay}">${t.label}</button>`}t.innerHTML=n;let r=document.querySelector(e.contentArea);r.innerHTML="",r.appendChild(t);for(let t of e.dataSource){let e=document.createElement("DIV");e.id=t.label.replace(/\s*/g,"_"),e.setAttribute("data-suic",t.id),e.style="display:none",r.appendChild(e)}let l=r.querySelectorAll("BUTTON");for(let t of l){let n=t.getAttribute("about");t.addEventListener("click",(async l=>{if(l.preventDefault(),t.getAttribute("data-directDisplay"))return void await solidUI.showPage(null,{link:t.getAttribute("about"),displayArea:r});let o=r.querySelectorAll(e.contentArea+" > DIV");for(let e of o)e.getAttribute("data-suic")===n?(e.style.display="block",await solidUI.activateComponent(e,r)):e.style.display="none"}))}return r}(n);if("ComponentButton"===n.type)return await async function(e){let t=e;"object"!=typeof e&&(t=await async function(e){let t=UI.rdf.Namespace("http://www.w3.org/ns/ui#"),n={};return e=UI.rdf.sym(e),await UI.store.fetcher.load(e),n.label=(UI.store.any(e,t("label"))||{}).value,n.content=(UI.store.any(e,t("icon"))||{}).value,n.style=(UI.store.any(e,t("style"))||{}).value,n.headerstyle=(UI.store.any(e,t("headerStyle"))||{}).value,n.dataSource=(UI.store.any(e,t("dataSource"))||{}).value,n}(e));let n=document.createElement("BUTTON");return n.innerHTML=t.icon?t.icon:t.label,n.addEventListener("click",(async e=>{await solidUI.processComponent(null,t.dataSource)})),n.style=t.style,n.style.cursor||="pointer",n.style.background||="#2196F3",n.style.color||="#ffffff",n.style.padding||="0.5em",n.style["border-radius"]||="0.2em",t.targetSelector&&t.targetSelector.appendChild(n),n}(n);if("Draggable"===n.type)return await L(n);if("ContainerSelector"===n.type)return await b(n);if("FeedList"===n.type)return await(new u).makeFeedSelector(n.contentSource,n.contentArea,n.displayArea);if("BookmarkTree"===n.type)await(new w).getTopic(n.contentSource,n.contentArea,n.displayArea,"start"),document.querySelector(n.contentArea).style="padding:0;margin:0;list-style:none;",document.getElementById("ocbStart").click();else{if("SelectorPanel"===n.type){let e=new f;return this.setDefaults(n),await e.render(n)}if("ModalButton"===n.type)return await(new m).render(n,this);if("Accordion"===n.type)return await(new p).render(this,n);if("FormComponent"===n.type)return await(new c).render(this,n);if("Tabset"===n.type)return await(new g).render(this,n)}if("Table"===n.type)return await(new s).render(n);let l,o,a,i,d,I=document.createElement("DIV");"Record"===n.type&&(d=this.getValue(r,ui("label")),i=this.getValue(r,ui("content")),l={label:d,content:i}),l=l||n.parts,this.log("Parts for Component",l);let k,S=n.template;if(!S)return l;if(S.groupOn&&(l=C.flatten(l,S.groupOn)),"AccordionMenu"==S){let e=await this.runBuiltIn(S,l);return e&&I.appendChild(e),I}if("Table"==S||"Table"===n.type){let e=await(new s).render(n);return e&&I.appendChild(e),I}if("ModalButton"==S){let e=await this.makeMmodal(n.label,n.content);return e&&I.appendChild(e),I}"string"==typeof S&&(S=await this.getComponentHash(S)),k=S.recurring,o=S.before,a=S.after;let v=this.fillTemplate(k,l);return I.innerHTML=(o||"")+v+(a||""),I}getObjects(e,t,n,r){let l=e.each(t,n,null,r);if(0===l.length)return l;let o=l[0].termType,a=e.any(l[0],this.rdf("first"));return"Collection"===o?l[0].elements:a?this.getRdfsList(e,l[0]):l}getRdfsList(e,t,n){n||=[],n.push(e.any(t,this.rdf("first")));let r=e.any(t,this.rdf("rest"));return r&&r.value===this.rdf("nil").value?n:this.getRdfsList(e,r,n)}async getComponentHash(e,t){if(!e)return t;if(!(e=await this.loadUnlessLoaded(e)))return null;let n=UI.store.match(e,null,null);t=t||{};for(let r of n){let n=r.predicate.value.replace(/http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#/,"").replace(/http:\/\/www.w3.org\/ns\/ui#/,""),l=r.object,o=e.doc?e.doc():e;if(this.getObjects(UI.store,e,r.predicate,o),t[n]||=[],"BlankNode"===l.termType)l=await this.getComponentHash(l),t[n]?"ARRAY"!=typeof t[n]?t[n]=[l]:t[n].push(l):t[n]=l;else if("Collection"===l.termType){l=l.elements;for(let e of l){let r=await this.getComponentHash(e,{});t[n]?t[n].push(r):t[n]=[r]}}else l=l.value.replace(/^http:\/\/www.w3.org\/ns\/ui#/,""),t[n]?"ARRAY"!=typeof t[n]?t[n]=[l]:t[n].push(l):t[n]=l;1==t[n].length&&(t[n]=t[n][0])}return t.id||=e.value,t}log(...e){"undefined"!=typeof DEBUG&&console.log(e)}setStyle(e,t){for(let n of Object.keys(t))e.style[n]=t[n]}async sparqlQuery(e,t,n){return"undefined"!=typeof Comunica?await C.comunicaQuery(e,t,n):await C.rdflibQuery(e,t,n)}getDefaults(e){return"string"==typeof e&&(e=this.processComponent("",e)),e.height||=this.height,e.width||=this.width,e.proxy||=this.proxy||"https://solidcommunity.net/proxy?uri=",e.background||=this.background||"#f6f6f6",e.color||=this.color||"#000",e.selBackground||=this.selBackground||"#559",e.selColor||=this.selColor||"#fff",e.unselBackground||=this.unselBackground||"transparent",e.unselColor||=this.unselColor||"#000",e.orientation||=this.orientation||"horizontal",e.position||=this.position||"left",this.proxy=e.proxy,e}setDefaults(e){return"string"==typeof e&&(e=this.processComponent("",e)),this.background=e.background,this.color=e.color,this.selBackground=e.selBackground,this.selColor=e.selColor,this.unselBackground=e.unselBackground,this.unselColor=e.unselColor,this.orientation=e.orientation,this.position=e.position,this.proxy=e.proxy,this.getDefaults(e)}fillTemplate(e,t){function n(e,t){for(let n of Object.keys(t)){let r=t[n]||" ";"object"==typeof r&&r.length>1&&(r=r.join(", "));let l=new RegExp(`\\$\\{${n}\\}`,"gi");e=e.replace(l,r)}return e}let r="";for(let l of t)r+=n(e,l)+"\n";return r}runBuiltIn(e,t,n){return t.match(/Table/)?this.results2table(e,n):t.match(/Modal/)?this.results2modal(n):t.match(/Accordion/)?tabset(n):t.match(/DescriptionList/)?this.results2descriptionList(n):void 0}diff(e,t){e.split(t).join("")}simulateClick(e){if(e.fireEvent)e.fireEvent("onclick");else{var t=document.createEvent("Events");t.initEvent("click",!0,!1),e.dispatchEvent(t)}}createElement(e,t,n,r){let l=document.createElement(e);if(t&&l.classList.add(t),n&&(l.innerHTML=n),r)for(let e of r.split(/;/)){let t=e.split(/:/);2==t.length&&(l.style[t[0].trim()]=t[1].trim())}return l}getComponentType(e){return e?UI.store.each(e,rdf("type")).map((e=>{if((e=e.value).match(/ns\/ui#/))return e.replace(/.*\#/,"")}))[0]||"":null}async clearInline(){for(let e of UI.store.match())e.graph.value.startsWith("inline:")&&UI.store.remove(e)}loadFromMemory(e){let t=e;if(UI.store.any(null,null,null,$rdf.sym(t)))return $rdf.sym(t);let[n,r]=t.split(/#/),l=document.getElementById(n),o=l.innerText||l.value;o=o.trim(),o.startsWith("<![CDATA[")&&(o=o.replace(/^\<\!\[CDATA\[/,"").replace(/\]\]$/,"").replace(/~~/g,"#"));try{return $rdf.parse(o,UI.store,t,"text/turtle"),$rdf.sym(t)}catch(e){console.log(e)}}async loadUnlessLoaded(e){try{if(!e)return;if(e&&e.termType&&"BlankNode"===e.termType)return e;if((e="object"==typeof e?e.uri:e).startsWith("inline"))return this.loadFromMemory(e);e.startsWith("http")||e.startsWith("ls")||(e=window.location.href.replace(/\/[^\/]*$/,"/")+e);const t=e.replace(/\#[^#]*$/,"");let n=$rdf.sym(t);return UI.store.any(null,null,null,n)?console.log(`<${n.uri}> already loaded!`):(console.log("loading "+n.uri+" ..."),await UI.store.fetcher.load(n.uri),UI.store.any(null,null,null,n)?console.log(`<${n.uri}> loaded!`):console.log(`<${n.uri}> could not be loaded!`)),$rdf.sym(e)}catch(t){return console.log(t),$rdf.sym(e)}}getValue(e,t,n,r){let l=UI.store.any(e,t,n,r);return l?l.value:""}valuesContain(e,t,n,r,l){let o=UI.store.each(e,t,n,r);for(let e of o)if(e=e?e.value:"",e===l)return e}};U.util=T,U.draggable=L})();