(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};function n(e,t,n){t=e.sym(t);let r=e.any(t,n);return r?r.value:""}function r(e,t,n){t=e.sym(t);let r=e.each(t,n),o=[];for(let e of r)o.push(e?e.value:"");return o}async function o(e,t,o){e||=document;let l=window.origin;t||=`${l}/profile/card#me`;const a=(t=await async function(e){const t=UI.rdf,o=t.Namespace("http://www.w3.org/2000/01/rdf-schema#"),l=t.Namespace("http://xmlns.com/foaf/0.1/"),a=t.Namespace("http://www.w3.org/ns/solid/terms#"),i=t.Namespace("http://www.w3.org/ns/pim/space#"),s=t.Namespace("http://www.w3.org/ns/ldp#"),c=t.Namespace("http://www.w3.org/2006/vcard/ns#"),d=window.kb,u=t.fetcher(d),p=t.sym(e);try{await u.load(e)}catch(e){return console.log("Couldn't load profile : "+e),{}}let y=d.each(e,o("seeAlso"));y=y.concat(d.each(p,l("primaryTopicOf")));for(let e of y)await u.load(e);return{webId:e,name:n(d,e,l("name"))||n(d,e,c("fn"))||n(d,e,l("nick"))||e,nick:n(d,e,l("nick"))||"",image:n(d,e,c("hasPhoto"))||"",inbox:n(d,e,s("inbox"))||"",preferences:n(d,e,i("preferencesFile"))||"",privateTypeIndex:n(d,e,a("privateTypeIndex"))||"",publicTypeIndex:n(d,e,a("publicTypeIndex"))||"",storages:r(d,e,i("storage"))||"",issuers:r(d,e,a("oidcIssuer"))||""}}(t)).storages?t.storages[0]:null;t.name=t.name||t.nick||t.webId;let i=e.querySelector("#currentPodLogo");i&&(i.src=t.image);let s=e.querySelector("#currentPodTitle");return s&&(s.innerHTML=`${t.name}'s Pod`),solidUI.vars={podRoot:a,podName:t.name,podNick:t.nick,podWebID:t.webId,podImage:t.image,podInbox:t.inbox,podProfile:t.webId},t}e.r(t),e.d(t,{CU:()=>p});class l{async fetchAndParse(e,t){e=(t||"")+encodeURI(e);let n=await fetch(e),r=await n.text(),o=(new window.DOMParser).parseFromString(r,"text/xml"),l=o.querySelectorAll("item")||null;l=l.length<1?o.querySelectorAll("entry"):l;let a=[];return l.forEach((e=>{let t=e.querySelector("link").innerHTML;t||(t=e.querySelector("link").getAttribute("href")),t&&!t.match(/ /)||(t=e.querySelector("content").innerHTML.replace(/.*\[link\]/,"").replace(/a href="/,"").replace(/"&gt;.*/,"").replace(/.*&lt;/,"")),t.match(/^http/)||(t=t.replace(/.*\[CDATA\[/,"")),t=t.replace(/^http:/,"https:");let n=e.querySelector("title").innerHTML;n=n.replace(/^\<\!\[CDATA\[/,""),n=n.replace(/\]\].*\>/,"").trim(),a.push({title:n,link:t})})),a}async render(e,t){let n="",r=UI.icons.iconBase+"/noun_189137.svg";r=`<img src="${r}" style="width:1em;height:1em;display:inline-block; padding-left:0.4em;opacity:0.5">`;for(let e of await this.fetchAndParse(t.href||t.link,t.proxy))"window"===t.displayTarget||(n+=`\n          <li about="${e.link}" typeof="rss:item" style="display:none;background:green;border:1px solid grey;">\n            <a href="${t.proxy+e.link}" property="rss:title" style="background:#999;display:inline-block">\n               ${e.title}\n            </a>\n            <a href="${e.link}" class="skipMunge" target="_BLANK" class="external">${r}</a>\n          </li>\n        `);const o=document.createElement("DIV");o.property="xmlns:rss",o.content="http://purl.org/rss/1.0/",t.standAlone?(o.innerHTML=`\n        <div about="${t.href}" typeof="rss:channel">\n          <b property="rss:title">${t.label}</b>\n          <ul typeof="rss:items" style="display:table">\n            ${n}\n          </ul>\n        </div>\n    `,o.querySelector("B").style=`padding:1em;padding-right:0;background:${t.selBackground};color:${t.selColor};border:1px solid grey;width:100%;display:inline-block`):(o.innerHTML=`\n        <div about="${t.href}" typeof="rss:channel">\n\x3c!--          <div property="title" style="background:#d0d0d0;padding:1em;">${t.label}</div>--\x3e\n          <ul typeof="rss:items" style="display:table">\n            ${n}\n          </ul>\n        </div>\n    `,o.querySelector("UL").style="padding:0;padding-left:0;list-style:none;margin-top:0;width:100%;"),o.querySelector("UL").style=`padding:0;border:1px solid grey;list-style:none;margin-top:0;width:100%;height:${t.height};overflow-y:auto;`;let l=o.querySelectorAll("A");for(let e of l)e.style="text-decoration:none;";let a=o.querySelectorAll("LI");for(let e of a)e.style="padding:0.5em;border-bottom:1px solid grey";return t.width&&(o.style.width=t.width),o}}function a(e,t){if(!e)return;const n=e.querySelectorAll("A");for(var r of n)r.innerHTML||alert(r),r.classList.contains("skipMunge")||(r.addEventListener("click",(async t=>{t.preventDefault();let n=e.dataset.target,r=t.target.closest(".solid-uic-app");r&&!n&&(n=r.querySelector(".main"));let o=t.target.href||t.target.parentElement.href;displayLink(null,{href:o,needsIframe:!0},n)})),t||(r.style="display:block;text-decoration:none;padding:0.5em; border-bottom:1px solid grey;color:#017698 !important;"));return e}String.prototype.interpolate=function(e){const t=Object.keys(e),n=Object.values(e);return new Function(...t,`return \`${this}\`;`)(...n)},window.toggleMenu=()=>{const e=document.getElementById("column-2");e.style.display||="block","block"===e.style.display?e.style.display="none":e.style.display="block"},window.toggleDarkMode=()=>{const e=document.getElementById("zContainer");e.classList.contains("darkMode")?e.classList.remove("darkMode"):e.classList.add("darkMode")},window.toggleFontSize=()=>{let e=document.body.style.fontSize||"100%";document.body.style.fontSize="100%"===e?"120%":"120%"===e?"140%":"140%"===e?"90%":"100%"},window.displayLink=async function(e,t,n){if("string"==typeof t&&(t={href:t}),t.href=t.href||t.link,t.type=t.type||"Link",t.type=t.type.replace(/http:\/\/www.w3.org\/ns\/ui#/,""),t.popout){let e=await solidUI.processComponent("",t.href);return e.style.display="block",document.body.appendChild(e),e}if(t.type.startsWith("SolidOS"))return solidUI.util.show("SolidOSLink",t.href);let r,o=document.getElementById("mainMain"),i=document.getElementById("suicTabulator");o&&(o.style.display="block"),i&&(i.style.display="none"),n&&!e&&(r=n);let s=e&&e.target?e.target.closest(".solid-uic-app"):null;s&&s.classList.contains("solid-main-app")?r=s.querySelector("#mainMain"):s&&(r=s.querySelector(".main")),r=r||document.body.querySelector(".main")||document.body,r&&(r.innerHTML="");let c=t.content;if(c){let e=document.createElement("SPAN");return c=c.interpolate(solidUI.vars),e.innerHTML=c,r.innerHTML="",r.appendChild(e),await solidUI.initInternal(r)}if("SolidOSLink"!==t.type){if("Feed"===t.type||"Feed"===t.linkType){let e=await(new l).render(solidUI,t);return e=a(e,"noStyle"),r.innerHTML="",r.appendChild(e),r}if("TransformLink"===t.type){if(t.href&&t.format&&t.format.match(/markdown/))return async function(e,t){let n=await fetch(e.href);n=await n.text(),t.innerHTML="";let r=document.createElement("SPAN");return r.innerHTML="\n<style>\n  h1 {display:none;}\n//  a{text-decoration:none; padding-top:0.25em;display:inline-block;padding-left:1em;}\n  ul {list-style:none;padding-left:0;margin-top:0;}\n</style>"+marked.parse(n),r=a(r,"noStyle"),r}(t,r)}else{if("Link"!==t.type){if(c=await solidUI.processComponent("",t),t.format||(c=a(c)),r.innerHTML="","string"==typeof c){let e=document.createElement("DIV");e.innerHTML=c,r.appendChild(e)}else r.appendChild(c);return r}if(c)return r.innerHTML=c,await this.initInternal(r);if(t.script){let e=await Function('"use strict";return ('+t.script+")")();return e=a(e),e}if(t.href){let e=await async function(e,t,n){let r=e.href;const o=document.createElement("IFRAME");if(o.style="width:100%;height:90vh;border:none;margin:0;padding:0;",o.src="",n)o.src=r;else try{let e=await fetch(r);if(e){e=await e.text(),t.innerHTML="",r=r.replace(/^.*proxy\?uri=/,""),r=new URL(r);const n=`<base href="${r.origin}/"><base target="_BLANK">`;o.srcdoc=`<body>${n}${e}</body>`,o.scrollTo({top:0,behavior:"smooth"})}else console.log("Fetched but no content!")}catch(e){console.log("Couldn't fetch!",e)}return o}(t,r,t.nativeIframe);return r.appendChild(e),r}}}};const i={Rolodex:'\n  <div style="overflow:auto;height:12rem;border:1px solid black;margin:1rem;padding:1rem;">\n    [~LOOP~]\n      <div style="display:table-row;">\n        <div style="display:table-cell;text-align:right;"><b>[~key~]</b></div>\n        <div style="display:table-cell;padding-left:1rem;">[~val~]</div>\n      </div>\n    [~LOOP~]\n  </div>\n',RecordsList:'\n  <div style="border:1px solid black;margin:1rem;padding:1rem;">\n    [~LOOP~]\n      <div style="display:table-row;">\n        <div style="display:table-cell;text-align:right;"><b>[~key~]</b></div>\n        <div style="display:table-cell;padding-left:1rem;">[~val~]</div>\n      </div>\n    [~LOOP~]\n  </div>\n'};async function s(e){const t=new c;let n=await t.sparqlQuery(e.endpoint,e.query);if(e.template||="ui:Table",n=await solidUI.processTemplate(e.template,n),e.displayArea){const t="string"==typeof e.displayArea?document.querySelector(e.displayArea):e.displayArea;t.innerHTML="",t.appendChild(n)}return n}class c{async sparqlQuery(e,t,n){return e.startsWith("/")?e=window.origin+e:e.startsWith("./")&&(e=window.location.href.replace(/\/[^\/]*$/,"")+e.replace(/^\./,"")),"undefined"!=typeof Comunica?await this.comunicaQuery(e,t,n):await this.rdflibQuery(e,t,n)}async rdflibQuery(e,t,n){const r=UI.rdf.graph();UI.rdf.fetcher(r),await r.fetcher.load(e);try{const e=await UI.rdf.SPARQLToQuery(t,!1,r);let n=e.vars.map((e=>e.label)),o=[],l=r.querySync(e);for(let e of l){let t={};for(let r of n){let n=e["?"+r];t[r]=n?n.value:""}o.push(t)}return o=o.sort(((e,t)=>e.label>t.label?1:-1)),o}catch(e){console.log(e)}}async comunicaQuery(e,t,n){try{let r,o=Comunica.newEngine();function l(e){return e?e.replace(/^"/,"").replace(/"[^"]*$/,""):""}n&&o.invalidateHttpCache();let a=await UI.store.fetcher.webOperation("GET",e);if(!a.ok)return void alert(a.statusText);try{r=await o.query(t,{sources:[e]})}catch(c){return void alert(c)}let i=r.variables;r=await r.bindings();let s=[];for(let d of r.entries()){if(!d[1]||!d[1]._root||!d[1]._root.entries)continue;d=d[1]._root.entries;let u={};for(let p in d.reverse()){let y=l(d[p][0].replace(/^\?/,""));u[y]=u[y]||"";let m=l(d[p][1].id);"ARRAY"!=typeof u[y]&&(u[y]=[u[y]]),"ARRAY"==typeof u[y]?u[y].push(m):u[y]=m}for(let h of i)h=h.replace(/^\?/,""),u[h]=u[h]||"";s.push(u)}return s.length||console.log("No results!"),s}catch(f){console.log(f)}}flatten(e,t){const n={};for(let r of e){let e=r[t];n[e]||(n[e]={});for(let t of Object.keys(r))n[e][t]?n[e][t].includes(r[t])||("object"!=typeof n[e][t]&&(n[e][t]=[n[e][t]]),n[e][t].push(r[t])):n[e][t]=r[t]}e=[];for(let t of Object.keys(n))e.push(n[t]);return e}}class d{render(e){let t=e.parts;if(!t||!t.length)return console.log("No results!"),document.createElement("SPAN");e.sortOn&&(t=t.reverse());let n=document.createElement("TABLE"),r=Object.keys(t[0]),o=document.createElement("TR");for(let t of r){let n=document.createElement("TH");n.innerHTML=t,n.style.border="1px solid black",n.style.padding="0.5em",n.style.background=e.unselBackground,n.style.color=e.unselColor,o.appendChild(n)}n.appendChild(o);for(let o of t){let t=document.createElement("TR");for(let n of r){e.cleanNodes&&(o[n]=o[n].replace(/.*\#/,"").replace(/.*\//,""));let r=document.createElement("TD");r.innerHTML=o[n],r.style.border="1px solid black",r.style.padding="0.5em",r.style.backgroundColor=e.background,r.style.color=e.color,t.appendChild(r)}n.appendChild(t)}return n.style.borderCollapse="collapse",n}}class u{async fromURL(e){let n=UI.rdf.sym(e);return await UI.fetcher.load(n),await this.render({form:e,formSubject:t.getProperty(n,"ui:formSubject"),script:t.getProperty(n,"ui:script"),resultDocument:t.getProperty(n,"ui:formResultDocument")})}async render(e){e.form||=e.contentSource;const t=e.dom||document,n=document.createElement("DIV");n.classList.add("uic-form");let r,o=UI.rdf.sym(e.form);if(e.formSubject&&(r=UI.rdf.sym(e.formSubject)),e.formString?UI.rdf.parse(string,UI.store,e.form,"text/turtle"):await UI.store.fetcher.load(e.form),!r){let e=UI.rdf.sym("http://www.w3.org/ns/ui#formSubject");r=UI.store.any(o,e)}if(e.forceReload&&r&&r.doc&&UI.store.removeDocument(r.doc()),!r)return n.innerHTML="ERROR : Could not load form subject ",n;await UI.store.fetcher.load(r.doc()),document.createElement("H2");let l=e.formResultDocument;r&&!l&&r.doc&&(l=r.doc());const a=e.script||function(){UI.store.fetcher.putBack(r)};try{UI.widgets.appendForm(t,n,{},r,o,l,a)}catch(e){n.innerHTML="FORM ERROR:"+e}return n}}class p{constructor(){this.UIO=UI.rdf.Namespace("http://www.w3.org/ns/ui#"),this.ISA=UI.rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type"),this.PIM=UI.rdf.Namespace("http://www.w3.org/ns/pim/space#")}removeClass(e,t){document.querySelector(e).classList.remove(t)}addClass(e,t){document.querySelector(e).classList.add(t)}newElement(e,t,n,r){let o=document.createElement(e);return t&&(o.id=t),n&&(o.classList=n),r&&(o.value=r),o}getProperty(e,t){let[n,r]=t.split(/:/);return UI.store.any(e,UI.ns[n](r))||""}getProperties(e,t){let[n,r]=t.split(/:/);return UI.store.each(e,UI.ns[n](r))||[]}getValues(e,t){let n=[],r=this.getProperties(e,t)||[];for(let e of r)n.push(e.value);return n}getObjects(e,t){return UI.store.each(e,t).map((e=>e.value))}getObject(e,t){let n=UI.store.any(e,t);return n&&n.value?n.value:""}menuize(e){if(!(e=document.querySelector(e)))return;let t=e.querySelectorAll("BUTTON");for(let e of t)e.addEventListener("click",(n=>{n.target;for(let e of t)e.classList.remove("selected");e.classList.add("selected")}))}findType(e,t){if(e||"undefined"==typeof sourceFile||(e=sourceFile),!e)return"unknown";let n=e.replace(/\#.*/,"").replace(/\?.*/,"").replace(/.*\./,"");return n?n.match(/(md)|(markdown)/)?"markdown":n.match(/(dot)|(gv)/)?"graphviz":n.match(/(ttl)|(rdf)|(n3)/)?"rdf":n.match(/(html)|(css)|(js)/)?n:"unknown":"unknown"}async show(e,t,n,r,o,l){return solidUI.hideTabulator&&solidUI.hideTabulator(),(e=e?e.replace(/.*\//,""):this.findType(t))&&e.match(/(html|rss|markdown)/)||(e="rdf"),await this._show[e](t,n,r,o,l)}_show={image:async(e,t,n)=>{if(n)return this.showIframeSrc(e,n)},pdf:async(e,t,n)=>{if(n)return this.showIframeSrc(e,n)},video:async(e,t,n)=>{if(n)return this.showIframeSrcDoc('<video controls="yes" src="'+e+'" style="max-width:100vw;max-height:100vh"></video>',e,n)},audio:async(e,t,n)=>{if(n)return this.showIframeSrcDoc('<audio controls="yes" src="'+e+'" style="margin-top:2em;"></audio>',e,n)},text:async(e,t,n)=>{if(t||=(await this.loadFile(e)).body,n)return this.showIframeSrcDoc(t,e,n);let r=document.createElement("DIV");return r.innerHTML=t,r},rss:async(e,t)=>{let n=await window.fetch(e),r=await n.text();return r=r.replace(/X-Frame-Options/g,""),e=e.replace(/^.*proxy\?uri=/,""),e=new URL(e),this.showIframeSrcDoc(r,e,t)},html:async(e,t,n)=>{if(e.match(/\.(md|markdown)$/))return this._show.markdown(e,t,n);if(t||=(await this.loadFile(e)).body,n)return this.showIframeSrcDoc(t,e,n);let r=document.createElement("DIV");return r.innerHTML=t,r},graphviz:async(e,t,n)=>{if(t||=(await this.loadFile(e)).body,!n){let e=document.createElement("DIV");try{d3.select(e).graphviz().renderDot(t,(()=>{}))}catch(e){alert(e)}return e}document.querySelector(n).innerHTML="";try{d3.select(n).graphviz().renderDot(t,(()=>{}))}catch(e){alert(e)}},markdown:async(e,t,n,r,o)=>{solidUI.hideTabulator&&solidUI.hideTabulator(),t||=(await this.loadFile(e)).body;let l=marked.parse(t);o&&o.styleSheet&&(l=`<link rel="stylesheet" href="${o.styleSheet}">`+l);const a=`\n      <body class="markdown-content" \n            style="background:${solidUI.pageBackground};color:${solidUI.pageColor}"\n      >\n    `;if(n)return this.showIframeSrcDoc(l,e,n,a);let i=document.createElement("DIV");return i.innerHTML=l,i.classList.add("markdown-content"),i.style.padding="4rem !important",i},Component:()=>{alert("utils.js Component")},SolidOSLink:async(e,t,n,r,o)=>{e||=o.href,solidUI.showTabulator&&solidUI.showTabulator();let l=document.getElementById("suicTabulator")||n;l&&(l.style.display="block");let a=l?l.querySelector("#outline")||l.querySelector(".outline"):null;a||(l=function(){let e=document.createElement("DIV");e.classList.add("TabulatorOutline");let t=document.createElement("TABLE");return t.classList.add("outline"),e.appendChild(t),e}(),a=l.querySelector(".outline"));let i=UI.rdf.sym(e),s=o&&o.pane?o.pane:null,c=o?o.plugin:"";c||="",o&&o.displayTarget,c.match(/ProfileEditor/)&&(s="editProfile"),c.match(/PreferencesEditor/)&&(s="basicPreferences"),s=s?panes.byName(s):null;const d=new URLSearchParams(location.search);return e=e.uri?e.uri:e,d.set("uri",e),await window.outliner.GotoSubject(i,!0,s,!0,null,a),window.history.replaceState({},"",`/cm/?${d}`),a},Form:async(e,t,n)=>{let r=e.doc?e.doc():e;r.value&&(r=r.value);const o=await(await new u).render({form:e.value});return t&&(t.startsWith("#")||(t="#"+t),document.querySelector(t).innerHTML="",document.querySelector(t).appendChild(o)),o},SparqlQuery:async(e,t,n)=>{let r=(UI.store.any(e,this.UIO("endpoint"),null)||"").value,o=(UI.store.any(e,this.UIO("query"),null)||"").value;o=o.replace(/\$\{[^\}]*\}/g,"");let l=(new d).render({parts:await(new c).sparqlQuery(r,o,n),cleanNodes:!0,sortOn:"term"});return t&&(document.querySelector(t).innerHTML="",document.querySelector(t).appendChild(l)),l},DataTemplate:async(e,t,n)=>{n||=UI.store;let r=this.getUIterm(e,"query"),o=this.getUIterm(e,"endpoint"),l=this.getUIterm(e,"template"),a=await(new c).sparqlQuery(o,r,n),i="";for(let e of a.reverse())i+=l.interpolate(e);t&&this.showIframeSrcDoc(i,e,t);let s=document.createElement("DIV");return s.innerHTML=i,s},PageDefinition:async(e,t)=>{e=this.getMainSubject(e);let n=new DOMParser,r=new XMLSerializer,o=this.getUIterm(e,"pageTemplate"),l=await this.loadFile(o),a=n.parseFromString(l.body,"text/html"),i=UI.store.match(e,this.UIO("component"));for(let e of i){let t,n;e=e.object,t=this.getObject(e,this.UIO("label")),n=this.getObject(e,this.UIO("href"));let r=this.fileInfo(n);r&&t&&a.querySelector("#"+t).appendChild(await this.show(r.contentType,n))}return a=r.serializeToString(a),t&&await this.showIframeSrcDoc(a,url,t),a},rdf:async(e,t,n,r,o)=>{if(o||={},solidUI.showTabulator&&solidUI.showTabulator(),o.dataSourceType)return await this._show[o.dataSourceType](e,t,n,r,o);try{let l=UI.rdf.sym(e.match(/\#/)?e:e+"#this");await this.crossLoad(e,t,r);let a=this.getUItype(l);return a&&a.match(/(Form)/)?await this._show[a](l,n,r):await this._show.SolidOSLink(UI.rdf.sym(e),n,r,o)}catch(e){return alert(e),e}}};mungeHash(e){return UI.rdf.sym(e.match(/\#/)?e:e+"#this")}async dataTemplate2Iframe(e,t){let n=this.getUIterm(e,"query"),r=this.getUIterm(e,"endpoint"),o=this.getUIterm(e,"template"),l=await(new c).sparqlQuery(r,n,UI.store),a="";for(let e of l.reverse())a+=o.interpolate(e);return this.showIframeSrcDoc(a,e,t),a}async template2Iframe(e,t){let n=this.getUIterm(e,"query");await UI.store.fetcher.load(n);let r=UI.rdf.sym(n+"#this"),o=this.getUIterm(r,"endpoint"),l=this.getUIterm(r,"query"),a=this.getUIterm(e,"before"),i=this.getUIterm(e,"beforeQuery");await UI.store.fetcher.load(i);let s=UI.rdf.sym(i+"#this"),d=this.getUIterm(s,"endpoint"),u=this.getUIterm(s,"query"),p=await(new c).sparqlQuery(d,u,UI.store);a=a.interpolate(p[0]);let y=await(new c).sparqlQuery(o,l,UI.store),m=this.getUIterm(e,"recurring"),h=this.getUIterm(e,"after"),f="";for(let e of y.reverse())f+=m.interpolate(e);let g=a+f+h;return this.showIframeSrcDoc(g,t),g}makeIframe(){let e=document.createElement("IFRAME");return e.style="height:100%;width:100%;border:none",e}show_iframe(e,t){return e.scrollTo({top:0,behavior:"smooth"}),(t="string"==typeof t?document.querySelector(t):t).innerHTML="",t.appendChild(e),e}showIframeSrc(e,t){let n=this.makeIframe();if(n.src=e,!t)return n;this.show_iframe(n,t)}showIframeSrcDoc(e,t,n,r){r||="<body>";let o=this.makeIframe();e=e.replace(/X-Frame-Options/g,""),t&&(t=new URL(t));const l=t?`<base href="${t.origin}${t.pathname}">`:"";return o.srcdoc=`${r}${l}${e}</body>`,o.scrollTo({top:0,behavior:"smooth"}),this.show_iframe(o,n)}makeSelector(e,t,n,r,o,l){let a=document.createElement("SELECT");a.style.background=l.darkBackground,a.style.width="100%",a.style["margin-top"]="1rem";for(let t of e){let e,n;if("string"==typeof t?e=n=t:(e=t[0],n=t[1]),n=(n||e).replace(/^http:\/\//,"").replace(/^https:\/\//,""),n.endsWith("/")||(n=n.replace(/.*\//,"")),!n||!t)continue;n||="/";let r=document.createElement("OPTION");r.style.color=l.lightBackground,r.value=r.title=e,r.style.fontSize="large",r.style.color=l.color||solidUI.buttonColor,r.style.backgroundColor=l.background||solidUI.buttonBackground,r.innerHTML=n,a.appendChild(r)}if(n&&(a.value=n),a.value||=a.childNodes[0].value,a.addEventListener("change",(async e=>{t(e.target.value)})),o&&(a.size=o),r){let e=document.querySelector(r);e.innerHTML="",e.appendChild(a)}return a}getParent(e){return e.replace(/\/$/,"").replace(/\/[^\/]*$/,"/")}fileInfo(e){if(!e)return;let t;"string"!=typeof e&&(e=e.url||e.uri);try{t=new URL(e)}catch(t){return console.log(77,e,t),{}}let n=t.pathname.replace(/.*\//,"").replace(/\.[^\.]*$/,"");n=n===t?"":n;let r,o,l=t.pathname.replace(/.*\//,"").replace(/.*\./,"");l=l===n?"":l,l.match(/(md)|(markdown)/)&&(r="markdown"),l.match(/(dot|gv)/)&&(r="graphviz"),l.match(/(ttl|rdf|n3)/)&&(r="rdf"),l.match(/txt/)&&(r="text",o="text/plain"),l.match(/(html)|(css)|(js)/)&&(r=l),l.match(/(gif|jpg|jpeg)/)&&(r=l),r||="unknown";let a=t.pathname.replace(/[^\/]*$/,"");n=decodeURI(n);let i=!n&&a.endsWith("/");return o="unknown",i?o="text/turtle":window.mime&&(o=window.mime.getType(e)),{url:e,file:n,path:a,ext:l,label:(n||a)+(l?"."+l:""),editable:o&&!o.match(/(image|video|audio|unknown)/),type:r,contentType:o,host:t.origin+"/",isHidden:!!e.match(/\/\./),isContainer:i}}async crossLoad(e,t,n){t?UI.rdf.parse(t,UI.store,e,"text/turtle"):await UI.store.fetcher.load(e);let r=this.fileInfo(e);return r.contentType="text/turtle",r.type="rdf",r.editable=!0,r}async gitApiFetch(e){e=(e=e.replace(/https:\/\/github.com/,"https://api.github.com/repos")).replace(/blob\/main\//,"contents");let t=await fetch(e,{Accept:"application/vnd.github.v3+html"});console.log(await t.text())}async loadFile(e,t){let n=this.fileInfo(e);if(e.match(/https:\/\/github.com/))return n.body=await this.gitApiFetch(e),n.editable=!n.contentType.match(/(image|video|audio|pdf|unknown)/),n.ok=!0,n;try{let r,o=t?{mode:"no-cors"}:{credentials:"omit"};try{r=await UI.store.fetcher.webOperation("GET",e,o)}catch(t){r=await UI.store.fetcher.webOperation("GET",e)}return r.ok?(n.contentType=r.headers.get("Content-Type"),n.editable=!n.contentType.match(/(image|video|audio|pdf|unknown)/),n.body=r.responseText,n.ok=r.ok):alert("utils.loadFile() "+r.status),n}catch(n){if(console.log("failed load, trying proxy"+n),!t)return this.loadFile("https://solidcommunity.net/proxy?uri="+encodeURI(e),"repeat");if(!t)return this.loadFile("https://solidcommunity.net/proxy?uri="+encodeURI(e),"repeat")}}getUItype(e){e=this.getMainSubject(e);let t=UI.store.each(e,this.ISA,null);for(let e of t)if(e.value.match(/ui\#/))return e.value.replace(/.*\#/,"")}getUIterm(e,t){e=this.getMainSubject(e);let n=UI.store.each(e,this.UIO(t)),r=[];if(n&&n[0]&&"Collection"===n[0].termType){for(let e of n[0].elements)r.push(UI.store.match(e));return r}return n[0]?n[0].value:n}getMainSubject(e){e=(e=e.uri?e.uri:e).match(/\#/)?e:e+"#this";try{return UI.rdf.sym(e)}catch(e){console.log(e)}}mungeLabel=e=>e?"Literal"===e.termType?`"${e}"`:("type"===(e=e.value.replace(/.*\#/,"").replace(/.*\//,""))&&(e="a"),e):"";mungeURL=e=>{let t=document.getElementById(e).value;return t.startsWith("http")||(t=window.location.href.replace("index.html","")+t),t};PUT=async(e,t,n)=>{e=e.replace(/\#[^\#]*$/,"");try{return await UI.store.fetcher.webOperation("PUT",e,{contentType:n,body:t})}catch(e){return e}}}function y(e){const t="undefined"!=typeof solidUI;e.color||=t?solidUI.menuColor:"#000000",e.background||=t?solidUI.menuBackground:"#c0c0c0",e.highlight||=t?solidUI.menuHighlight:"#909090",e.size||=t?solidUI.selectorSize:0;const n=e.color,r=document.createElement("DIV");let o=document.createElement("DIV");o.style=`border:1px solid ${n};border-bottom:none`,o.style.background=e.background,o.style.color=e.color,e.parts||=e.dataSource.parts;const l=e.label||e.parts[0]?e.parts[0].label||e.parts[0]:"";o.innerHTML=`<div style="border-bottom:1px solid ${n}; padding:0.5em;cursor:pointer;"><span style="display:table-cell;width:100%">${l}</span><span style="display:table-cell;width:100%;text-align:right;">⌄</span></div>`;let a=document.createElement("DIV");o.querySelector("div").onclick=()=>{a.style.display||="block","block"===a.style.display?a.style.display="none":a.style.display="block"};for(let t of e.parts)t.link||=t.value,t.type||=t.contentType,a.innerHTML+=`<a href="${t.link}" style="text-decoration:none;display:block;border-bottom:1px solid ${n}; padding:0.5em; background-color:${e.highlight};color:${e.color}" data-label="${t.label}" data-link="${t.link}" data-type="${t.type}">${t.label}</a>`;let i=a.querySelectorAll("A");for(let t of i)t.onclick=t=>{t.preventDefault();let n=t.target;for(let t of i)t.style.background=t==n?e.background:e.highlight;return e.size||(n.parentElement.style.display="none",o.querySelector("DIV SPAN").innerHTML=n.innerHTML),console.log(99,n.href,n.dataset.type,n.dataset.link),e.onchange(n.innerHTML,n.href,n.dataset.type)};return e.size?(e.size>e.parts.length&&(e.size=e.parts.length),e.size=2*e.size+1+"rem",a.style=`border:1px solid ${n};border-top:none;height:${e.size}`,a.style.overflow="auto",a.style["max-height"]=e.size):(a.style=`border:1px solid ${n};border-top:none;display:none`,o.style["margin-bottom"]="0.4rem",r.appendChild(o)),a.style["margin-bottom"]="0.4rem",r.appendChild(a),r}String.prototype.interpolate=function(e){const t=Object.keys(e),n=Object.values(e);return new Function(...t,`return \`${this}\`;`)(...n)};class m{async makeFeedSelector(e,t,n,r){self=this,self.displayArea=n;const o=new p,l=UI.rdf.Namespace("http://www.w3.org/ns/ui#"),a=UI.rdf.Namespace("http://www.w3.org/2004/02/skos/core#"),i=UI.rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");let s=document.body;await o.crossLoad(e),e=UI.rdf.sym(e);let c=UI.store.each(null,i("type"),l("FeedTopic")),d=[];for(let e of c)d.push({link:e.value,label:UI.store.any(e,l("label")).value,linkType:"Feed"});let u=y({parts:d,onchange:async(e,n,o)=>{await h(n,t,r),document.querySelector("#collectionSelector A").style.backgroundColor=solidUI.menuBackground},size:3});if(u.id="topicSelector",t){s="string"==typeof t?document.querySelector(t):t,s.innerHTML="";let e=o.newElement("DIV","collectionHolder"),n=o.newElement("DIV","itemSelector");s.appendChild(u),s.appendChild(e),s.appendChild(n),await h(d[0].link,s,r)}let m=s.querySelectorAll("#feedMenu select");for(let e of m)e.style="display:block; width:100%;  padding:0.5rem; margin-bottom:1rem; border-radious:0.02rem;";async function h(e,n,r){"string"==typeof e&&(e=UI.rdf.sym(e)),await o.crossLoad(e);let i=UI.store.each(null,a("broader"),e),s=[];for(let e of i){let t=UI.store.any(e,l("href")).value,n=UI.store.any(e,l("label")).value,r="Feed-Article";s.push({link:t,label:n,linkType:r})}let c=y({parts:s,onchange:async(e,n,r)=>{await f(n,t)},size:5});c.id="collectionSelector";let d=(n||document).querySelector("#collectionHolder");d.innerHTML="",d.appendChild(c);let u=d.querySelectorAll("#feedMenu select");for(let e of u)e.style="display:block; width:100%;  padding:0.5rem; margin-bottom:1rem; border-radious:0.02rem;";let p=d.querySelectorAll("#feedMenu option");for(let e of p)e.style.fontSize="large",e.style.color=json.color||solidUI.buttonColor,e.style.backgroundColor=json.background||solidUI.buttonBackground;await f(s[0].link,r)}async function f(e,t){let n=document.getElementById("itemSelector");n.innerHTML="",n.appendChild(await self.items2list({href:e},t))}document.querySelector("#topicSelector A").style.backgroundColor=solidUI.menuBackground,document.querySelector("#collectionSelector A").style.backgroundColor=solidUI.menuBackground,document.querySelector("#itemSelector A").style.backgroundColor=solidUI.menuHighlight}async fetchAndParse(e,t){let n;e=(t=void 0===t?"https://solidcommunity.net/proxy?uri=":t)+encodeURI(e);try{let t=await fetch(e),r=await t.text();n=(new window.DOMParser).parseFromString(r,"text/xml")}catch(e){alert(e)}let r=n.querySelectorAll("item")||null;r=r.length<1?n.querySelectorAll("entry"):r;let o=[];return r.forEach((e=>{let t=e.querySelector("link").innerHTML;t||(t=e.querySelector("link").getAttribute("href")),t&&!t.match(/ /)||(t=e.querySelector("content").innerHTML.replace(/.*\[link\]/,"").replace(/a href="/,"").replace(/"&gt;.*/,"").replace(/.*&lt;/,"")),t.match(/^http/)||(t=t.replace(/.*\[CDATA\[/,"").replace(/\]\]\>$/,"")),t=t.replace(/^http:/,"https:");let n=e.querySelector("title").innerHTML;n=n.replace(/^\<\!\[CDATA\[/,""),n=n.replace(/\]\].*\>/,"").trim(),o.push({title:n,link:t})})),o}async items2list(e,t){let n=document.getElementById("itemSelector");n.style="\n      margin-top:0.5rem;\n      margin-top:1rem;\n      border:1px solid gray;\n      border-radius:0.4rem;\n      height:50vh;\n      overflow-y:scroll;\n      overflow-x:hidden; \n    ",n.innerHTML="",e.proxy||="https://solidcommunity.net/proxy?uri=";let r="",o=UI.icons.iconBase+"/noun_189137.svg";o=`<img src="${o}" style="width:1em;height:1em;display:inline-block; padding-left:0.4em;opacity:1">`;for(let n of await this.fetchAndParse(e.href||e.link,e.proxy))"window"===e.displayTarget||(r+=`\n          <li about="${n.link}" typeof="rss:item" style="color:${e.color||solidUI.buttonColor};background-color:${e.background||solidUI.buttonBackground}">\n            <a href="${e.proxy+n.link}" target="#display" property="rss:title" style="display:inline-block;border:none !important">\n               <span style="color:${t.color||solidUI.buttonColor} !important;background:${t.background||solidUI.buttonBackground};display:inline-block;font-size:large">${n.title}</span>\n            </a>\n            <a href="${n.link}" class="skipMunge" target="_BLANK" class="external">${o}</a>\n          </li>\n        `);const l=document.createElement("DIV");l.property="xmlns:rss",l.content="http://purl.org/rss/1.0/",e.standAlone?(l.innerHTML=`\n        <div about="${e.href}" typeof="rss:channel" style="color:${e.color||solidUI.buttonColor};background-color:${e.background||solidUI.buttonBackground}">\n          <b property="rss:title">${e.label}</b>\n          <ul typeof="rss:items" style="display:table;backgroundColor:${e.background||solidUI.buttonBackground}">\n            ${r}\n          </ul>\n        </div>\n    `,l.querySelector("B").style=`padding:1em;padding-right:0;background:${e.background||solidUI.buttonBackground};color:${e.color||solidUI.buttonColor};border:1px solid grey;width:100%;display:inline-block`):(l.innerHTML=`\n        <div about="${e.href}" typeof="rss:channel" style="color:${e.color||solidUI.buttonColor};background-color:${e.background||solidUI.buttonBackground}">\n\x3c!--          <div property="title" style="background:${e.background||solidUI.buttonBackground};padding:1em;">${e.label}</div>--\x3e\n          <ul typeof="rss:items" style="display:table">\n            ${r}\n          </ul>\n        </div>\n    `,l.querySelector("UL").style="padding:0;padding-left:0;list-style:none;margin-top:0;width:100%;"),l.querySelector("UL").style=`padding:0;border:1px solid grey;list-style:none;margin-top:0;width:100%;height:${e.height};overflow-y:auto;`;let a=l.querySelectorAll("A");solidUI.simulateClick(a[0]);for(let t of a)t.style="text-decoration:none;",t.fontSize="large",t.color=e.color||solidUI.buttonColor+" !important",t.onclick=async n=>{if(n.target.parentNode.classList.contains("skipMunge"))return;n.preventDefault();let r=n.target.parentNode.href;await solidUI.util.show("rss",r,self.displayArea);for(let n of a)n.style.backgroundColor=n==t?e.menuBackground:e.menuHightlight};let i=l.querySelectorAll("LI");for(let e of i)e.style="padding:0.5em;border-radius:0.4em;background:${json.background||solidUI.buttonBackground}";return e.width&&(l.style.width=e.width),l}}async function h(e){e.orientation||=e.contentArea.dataset.orientation,e.compact||=1,(e.includeMetadata||e.contentArea.dataset.includemetadata)&&(e.compact=0),e.allowDownload||=e.contentArea.dataset.allowdownload;let t=UI.rdf.sym(e.id);await UI.store.fetcher.load(t);let n=function(e){return{byArtist:(UI.store.any(e,UI.ns.schema("byArtist"))||{}).value,encoding:(UI.store.any(e,UI.ns.schema("encoding"))||{}).value,image:(UI.store.any(e,UI.ns.schema("image"))||{}).value,description:(UI.store.any(e,UI.ns.schema("description"))||{}).value,country:(UI.store.any(e,UI.ns.schema("countryOfOrigin"))||{}).value}}(t);n.vertical=document.body.offsetWidth<750||1==e.orientation,n.isVideo=!1;let r=UI.store.match(t,UI.ns.rdf("type"));for(let e of r)e.object.value.match(/video/i)&&(n.isVideo=!0);return function(e,t){let n=document.createElement("DIV");if(e.download=t.allowDownload?"":'controlslist="nodownload"',e.vertical?(e.align="center",e.width="310px",e.audioWidth="272px !important",e.imageStyle="width:272px;margin-top:0.5rem;margin-bottom:0.4rem;"):(e.audioWidth="272px !important",e.imageStyle="height:180px;float:left;margin-right:1rem;margin-top:0.5rem;",e.width="590px",e.align="left"),e.isVideo?(e.audio="",e.visual=`<iframe height="200" src="${e.encoding}" title="YouTube video player" frameborder="0" allow="accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen style="float:left;margin:1rem;margin-left:0;margin-bottom:0;"></iframe>`):(e.visual=`<img src="${e.image}" style="${e.imageStyle}">`,e.audio=`<audio title="${e.byArtist}" controls ${e.download} preload="metadata" style="width:${e.audioWidth}"><source src="${e.encoding}" type="audio/mpeg"></audio>`),t.compact){let t=document.createElement("SPAN");return t.innerHTML=e.isVideo?e.visual:e.audio,t}return n.style=`min-height:212px; margin:0.8rem;text-align:${e.align}; padding:0.5rem; border-radius:0.5rem; background:#bb99ff; color:black; width:${e.width}`,n.innerHTML=`\n  <div>\n    <b>${e.byArtist}</b> - ${e.country}\n  </div>\n  ${e.visual}\n  <p>${e.description}</p>\n  ${e.audio}\n    `,n}(n,e)}!async function(){let e=document.querySelectorAll("[data-suicFeedMenu]");for(let t of e){let e=t.dataset.suicfeedmenu;e.startsWith("/")&&(e=window.origin+e);let n=t.dataset.display,r="#"+t.id;const o=new m;await o.makeFeedSelector(e,r,n)}}();class f{async render(e,t){const n=t.parts,r=e.createElement("DIV","accordion");if(!n||!n.length)return r;for(let o of n){let n=e.createElement("DIV"),l=e.createElement("DIV",""),a=e.createElement("SPAN","",o.label||o.topic);a.style.display="table-cell",a.style.width="100%",l.appendChild(a);let i=e.createElement("SPAN","caret-down","⌄");i.style.display="table-cell",i.textAlign="right",l.appendChild(i),l.style.backgroundColor=t.unselBackground,l.style.color=t.unselColor,l.style.padding="0.75em",l.style.border="1px solid grey",l.style.cursor="pointer";let s=e.createElement("DIV");if(o.content)s.innerHTML=o.content;else{console.log(t);for(let t=0;t<o.linkLabel.length;t++){let n=o.linkLabel[t],r=o.linkUrl[t],l=e.createElement("BUTTON","",n);l.setAttribute("data-link",r),l.style.width="100%",l.style.border="none",l.style.background="transparent",l.style.marginBottom="0.25em",l.style.cursor="pointer",l.onclick=e=>{showByClass(e)},s.appendChild(l)}}s.style.padding="0.75em",s.style.border="1px solid grey",s.style.borderTop="none",s.style.display="none",l.onclick=e=>{let t="block"===s.style.display,n=r.children;for(let e of n)e.children[1].style.display="none";s.style.display=t?"none":"block"},s.style.backgroundColor=t.background,s.style.color=t.color,n.appendChild(l),n.appendChild(s),n.style.marginBottom="1em",r.appendChild(n)}return e.simulateClick(r.querySelector("DIV DIV DIV")),await e.initInternal(r)}}class g{async render(e,t){function n(e){let t=function(){let e=document.createElement("DIV");e.style="height:1rem",document.body.appendChild(e);let t=e.clientHeight;return document.body.removeChild(e),t}();return e.menuHeight=2*t,e.headerHeight=6*t,window.SolidAppContext={scroll:e.headerHeight},e.mainHeight=window.innerHeight-e.headerHeight,e.headerHeight=e.headerHeight.toString()+"px",e.mainHeight=e.mainHeight.toString()+"px",e}(t=e.setDefaults(t)).fullPage&&(window.addEventListener("resize",(()=>{t=n(t);let e=document.getElementById("mainMain"),r=document.getElementById("suicTabulator");e&&(e.style.height=t.mainHeight),r&&(r.style.height=t.mainHeight)})),document.body.style.overflow="hidden"),t=n(t),t.logo||="",t.title||="",t.headerHeight=t.logo||t.title||t.adminMenu?t.headerHeight:"0",t.leftMenu="",t.siteMenu="","horizontal"===t.orientation?t.leftMenuStyle="display:none":t.leftMenuStyle=`\n        display:block;\n        width:36vw !important;\n        height:${t.mainHeight};\n        overflow-y:scroll;\n        margin:0;\n        padding:0;\n      `;let r=await this.getHTML(t),l=e.createElement("SPAN","",r),a=l.querySelector("#solidLogo");a&&(a.src="https://solidproject.org/assets/img/solid-emblem.svg");let i=l.querySelector("#currentPodMenu");"vertical"===t.orientation&&(i=l.querySelector("NAV"));const s=await e.processComponent(i,t.currentPodMenu);if(s&&i&&i.appendChild(s),t.userMenu){const n=await e.processComponent(i,t.userMenu);let r=l.querySelector("#userMenu");r&&r.appendChild(n)}if(t.loginBox&&await async function(e){const t=e.querySelector("#loginArea"),n=panes.UI;async function r(e){await async function(){n.authn.currentUser()||await n.authn.checkUser()}(),t.innerHTML="",t.appendChild(n.authn.loginStatusBox(document,null,{}));let r=t.querySelectorAll("input");r[0].value=r[0].value.replace(/WebID\s*/,""),r[1]&&(r[1].style.display="none")}e.querySelector("#suicTabulator"),n.authn.authSession&&(n.authn.authSession.onLogin((()=>{r()})),n.authn.authSession.onLogout((()=>{r()})),n.authn.authSession.onSessionRestore((e=>{r()}))),r()}(l),await o(l),t.initialContent){let n=await e.getComponentHash(t.initialContent);n=n.content.interpolate(e.vars);let r=l.querySelector("#mainMain");r&&(r.innerHTML=n)}return l}rem2vw(e){return e*(100/document.body.clientWidth)}rem2vh(e){return 16*e*(100/window.innerHeight)}async getHTML(e){if(e.leftColumnColumnStyle||="display:none",e.leftColumnColumnMenu||="",e.siteMenu||="",e.leftColumnColumnStyle||="",e.iframeSrc||="",e.iframeContent||="",e.logoStyle="\n             height: 3rem;\n            display: inline-block;\n       padding-left: 0.5rem;\n     ",e.titleStyle='\n       display:inline-block;\n       vertical-align:top; align:left;\n       font-size: 2rem;\n       padding-top: 0.4rem;\n       padding-left:1rem;"\n     ',e.appStye="\n              display: flex;\n       flex-direction: column;\n                width: 100%;\n               height: 100%;\n     ",e.mainStyle=`\n        padding:0rem;\n        width:100%;\n        overflow:scroll;\n        position:absolute;\n        top:${e.headerHeight} !important;\n        left:0;\n        height:${e.mainHeight};\n     `,e.theme)try{let t=await window.fetch(e.theme),n=await t.text();return n=solidUI.fillTemplate(n,[e]),await n}catch(e){console.log(e)}return""}}class w{async render(e,t,n){"string"==typeof t&&(t=await e.processComponent(n,t)),t.displayArea&&t.landingPage&&await e.processComponentSubject(t.landingPage);let r=e.createElement("NAV","solid-uic-dropdown-menu"),o=document.createElement("UL"),l=document.createElement("DIV");this.pluginMenuArea=document.createElement("DIV"),this.pluginMenuArea.id="pluginMenuArea",this.pluginMenuArea.style.paddingTop="3rem";const a=e.createElement("DIV");for(var i of(a.style.width="100%",a.style["overflow-x"]="hidden",o=I(o,t),a.appendChild(r),a.appendChild(l),a.appendChild(this.pluginMenuArea),r=b(r,t),l=function(e,t){return e.style.width="100%",e}(l),l.innerHTML="",l.classList.add("main"),r.appendChild(o),t.parts))o.appendChild(await this.renderMenuItem(i,t,l));return a}async renderMenuItem(e,t,n){if(e.menu&&e.menu.type&&"SparqlQuery"===e.menu.type){let t=await solidUI.processComponent(null,null,e.menu);"object"==typeof t&&(e.parts=t)}if(!e.parts&&e.dataSource&&(!e.pluginType||"resourceSelector"!=e.pluginType)){let t=await solidUI.getComponentHash(e.dataSource);e.parts=t&&t.parts?t.parts:null}let r=document.createElement("LI");const o=document.createElement("SPAN");if(o.innerHTML=e.label,r.appendChild(o),r.onmouseover=()=>{r.style.color=solidUI.menuColor,r.style.background=solidUI.menuHighlight},r.onmouseout=()=>{r.style.color=solidUI.menuColor,r.style.background=solidUI.menuBackground},e.popout||!e.parts)r.classList.add("item"),r.name=e.href||e.dataSource&&e.dataSource.dataSource?e.dataSource.dataSource:e.dataSource,r.pluginType=e.pluginType,r.dataset.link=r.name,r.dataset.linktype=e.pluginType,r.dataset.label=e.label,r.onclick=async t=>{let n=r.dataset.link,o=r.dataset.linktype||r.dataset.link||"",l=r.dataset.label,a=this.pluginMenuArea;"SolidOS"===o&&(a=document.getElementById("outline"));let i=l.replace(/\s/g,"_"),s=a.querySelector("#"+i),c=await solidUI.processComponentSubject(n);c||=e,c.landingPage&&await solidUI.processComponentSubject(c.landingPage),c.contentArea="#"+i;for(let e of a.childNodes)e.style.display="none";s||"SolidOS"==o||(s=document.createElement("DIV"),s.id=i,a.appendChild(s),s.innerHTML=`<h3 style="margin:0;margin-bottom:0.5rem;">${t.target.innerHTML}</h3>`,c.type?(c=await solidUI.processComponentJson(c),s.appendChild(c)):c.dataSource&&"SolidOS"!==!o||s.appendChild(c),"resourceSelector"===o&&s.appendChild(c)),s&&(s.style.display="block",s.focus())},r=function(e,t){return e.style.cursor="pointer",e.style.display="inline-block",e.style.padding="0.5rem",e.style.margin="0.25rem",e.style.color=t.color||solidUI.menuColor,e.style.background=t.background||solidUI.menuBackground,e}(r,t);else{r.classList.add("caret");let o=document.createElement("UL");for(var l in o.style.background="white",o.style.width="100%",r.appendChild(o),o.classList.add("nested"),void 0===e.parts.length&&(e.parts=[e.parts]),e.parts){let r=e.parts[l];"object"==typeof r&&(r.target=t.target),o.appendChild(await this.renderMenuItem(r,t,n))}}return r}}function b(e,t){return e.style.padding="0 !impotant",e.style.background=t.color||solidUI.menuBackground,e.style.color=t.background||solidUI.menuColor,e.style.display="inline-block",e.style.textAlign=t.position,e}function I(e,t){return e.style.color=solidUI.menuColor,e.style.background=solidUI.menuBackground,e.style.padding="0 !impotant",e.style.margin="0 !impotant",e.style.textAlign=t.position,e.style["padding-inline-start"]="0 !important",e}class k{async render(e,t){let n=e.dom||document,r=document.createElement("SPAN");e.targetSelector&&(r=n.querySelector(e.targetSelector));(i=e).darkBackground,i.unselColor;const o="\n      display: none; /* Hidden by default */\n      position: fixed; /* Stay in place */\n      left: 0;\n      top: 0;\n      overflow: auto; /* Enable scroll if needed */\n      background-color: rgb(0,0,0); /* Fallback color */\n      background-color: rgba(0,0,0,0.8); /* Black w/ opacity */\n      width: 100%; /* Full width */\n      height: 100%; /* Full height */\n      z-index:20000;\n      text-align:center;\n    ",l=`\n//      background-color: #fefefe;\n      background-color: ${i.lightBackground};\n      margin: 5% auto; /* 15% from the top and centered */\n      width:80vw;\n      height:85vh;\n      padding: 1rem;\n      border: 1px solid #888;\n      border-radius:0.5rem;\n    `,a="\n      color:red;\n      text-align:right;\n      margin-bottom: 0.25rem;\n      font-size: 2rem;\n      font-weight: bold;\n      cursor:pointer;\n    ";var i;e.iframe&&(document.createElement("IFRAME"),e.content=`<iframe src="${e.iframe}" style="width:100%;height:90%;border:none"></iframe>`),!e.content&&e.dataSource&&(e.content=(await t.processComponentSubject(e.dataSource)).outerHTML),r.innerHTML=`\n      <button style="${e.style}" title="${e.title}" onclick="window.openModal(this)">\n        ${e.label}\n      </button>\n      <div style="${o}">\n        <div class="suic-modal-content" style="${l}">\n          <div style="${a}" onclick="window.closeModal(this)">\n            &times;\n          </div>\n          ${e.content}\n        </div>\n      </div>\n    `;let s=r.querySelector("button");return s=t.styleButton(s,e),t&&(r=await t.initInternal(r)),e.contentArea&&e.contentArea.appendChild(r),r}}window.openModal=function(e,t){e.parentElement.children[1].style.display="block"},window.closeModal=function(e,t){e.parentElement.parentElement.style.display="none"};class S{constructor(){this.store=UI.rdf.graph(),this.fetcher=UI.rdf.fetcher(this.store,{fetch:UI.store.fetcher._fetch})}async init(){for(let e of document.getElementsByClassName("ocb")){let t=e.dataset.component;this.bookmarksDisplay=e.dataset.display;try{t=await this.loadUnlessLoaded(t),e=e.appendChild(document.createElement("UL")),await this.getTopic(t,e,this.bookmarksDisplay,"start"),document.getElementById("ocbStart").click()}catch(e){alert(e)}}}async getTopic(e,t,n,r){const o=this;"string"==typeof t&&(t=document.querySelector(t)),n||=t.dataset.display,this.bookmarksDisplay||=n;let l=UI.rdf.Namespace("http://www.w3.org/2002/01/bookmark#");const a=UI.rdf.Namespace("http://www.w3.org/2000/01/rdf-schema#"),i=UI.rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#"),s=UI.rdf.Namespace("http://www.w3.org/ns/ui#");e=await this.loadUnlessLoaded(e);let c=this.store.any(e,a("label"),null,e.doc());c=void 0===c?"???":c.value;let d=document.createElement("SPAN");d.appendChild(document.createTextNode(c)),d.classList.add("caret"),d.addEventListener("click",(function(){let e=this.parentElement.querySelector(".nested");e&&e.classList.toggle("active"),this.classList.toggle("caret-down")}));let u=document.createElement("LI");r&&(d.id="ocbStart"),u.appendChild(d),t.appendChild(u);let p=this.store.each(null,l("subTopicOf"),e);if(p.length>0){let e=document.createElement("UL");e.classList.add("bookmarkTree"),e.classList.add("nested"),u.appendChild(e);for(let t in p)this.getTopic(p[t],e)}else{let t=this.store.each(null,l("hasTopic"),e),n=document.createElement("UL");n.classList.add("nested");for(let r in t){let c=t[r],d=this.store.any(c,a("label"),null,e.doc()),u=this.store.match(c,i("type"),s("Feed")).length;d=d?d.value:"???";let p=this.store.any(c,l("recalls"),null,e.doc()),y=document.createElement("LI");u?y.classList.add("caret"):y.classList.add("item"),u?y.addEventListener("click",(async function(){alert("Feed Me!")})):y.addEventListener("click",(async function(){document.querySelector(o.bookmarksDisplay).innerHTML=`<iframe src="${p.uri}"></iframe>`})),y.appendChild(document.createTextNode(d));let m=document.createElement("DIV");m.classList.add("closed"),y.appendChild(m),n.appendChild(y)}u.appendChild(n)}}async loadUnlessLoaded(e){try{const t=document.location.href.replace(/\/[^\/]*$/,"/");if(e=(e="string"==typeof e?e:e.uri).match("//")?e:t+e,"BlankNode"===(e=UI.rdf.sym(e)).termType)return e;this.store.any(null,null,null,e.doc())||await this.fetcher.load(e)}catch(e){alert(e)}return e}}async function U(e){let t=e.dataSource||e.podLink,n=e.contentArea,r=e.collectionSize||6,o=e.resourceSize||10,l=e.onchange;"undefined"!=typeof solidUI&&(l||=async(e,t,n)=>{await solidUI.showPage(null,null,{label:e,link:t,cType:n})});const a=UI.rdf.Namespace("http://www.w3.org/ns/ldp#");if(!t)return"";let i=t.replace(/\/[^\/]*$/,"/");!function(e){try{new URL(e).host}catch(t){return console.log(e,t),e}}(i);const s=UI.rdf.sym(i);try{await UI.store.fetcher.load(s)}catch(e){alert(e)}let c=UI.store.each(s,a("contains"),null,s),d=[],u=[];u.push({value:s.uri,label:T(s.uri)});for(let e of c.sort()){let t=e.value,n=v(e);C(t)||(t.endsWith("/")?u.push({value:t,label:T(t),contentType:"text/turtle"}):d.push({value:t,label:T(t),contentType:n}))}let p=s.uri.replace(/\/$/,"").replace(/\/[^\/]*$/,"/");if(p&&(p.endsWith("//")||u.splice(1,0,{value:p,label:"../"})),u=await L(u,(async(t,n)=>{let r=n||t.target.value;e.dataSource=r;let o=await U(e),l=document.querySelector("#PodSelector");return l&&(l.innerHTML="",l.appendChild(o)),o}),0,0,r),d=await L(d,l,0,0,o),u.classList=["containerSelector"],d&&(d.classList=["resourceSelector"]),n&&"string"==typeof n&&(n=document.querySelector(n)),!n){let t=e.label.replace(/\s/g,"_");n=document.getElementById(t)}let y=document.createElement("DIV"),m=document.createElement("DIV");return m.style="width:100% !important;text-align:right",m.innerHTML=`\n       <span style="color:white !important">Pod Explorer</span>\n       <a href="${i}" style="display:inline-block !important;color:gold !important;text-align:right !important;"><img src="https://solidproject.org/assets/img/solid-emblem.svg" style="height:2rem;width:2rem;margin-left:2rem;" /></a>\n    `,y.innerHTML="",y.appendChild(m),y.id="PodSelector",u&&y.appendChild(u),d&&y.appendChild(d),y}function v(e){const t=UI.rdf.sym("http://www.w3.org/1999/02/22-rdf-syntax-ns#type");let n=UI.store.each(e,t).map((e=>e.value));for(let e of n)if(e.match(/http:\/\/www.w3.org\/ns\/iana\/media-types/))return e.replace(/http:\/\/www.w3.org\/ns\/iana\/media-types\//,"").replace(/\#Resource/,"")}function C(e){if(!e)return!0;let t=new URL(e);return t=t.pathname,t=t.endsWith("/")?t.replace(/^\//,""):t.replace(/.*\//,""),!!t.startsWith(".")||!!t.match(/\/\./)||!!t.endsWith("~")||void 0}function T(e){try{return new URL(e).pathname}catch(t){return console.log(e,t),e}}function L(e,t,n,r,o,l){for(let t of e)t.label=(a=t.label)?((a=decodeURI(a)).endsWith("/")||(a=a.replace(/.*\//,"")),a||"/"):"";var a;return y({parts:e,onchange:t,size:o})}async function A(e){let t=e;"object"!=typeof e&&(t=await getFloatComponent(e));let n=function(e){return e.label.replace(/\s+/g,"_")}(t),r=document.getElementById(n);if(r)return void(r.style.display="block");let o,l,a,i,s=document.createElement("DIV"),c=document.createElement("DIV"),d=document.createElement("SPAN"),u=document.createElement("DIV"),p=document.getElementById("right-column-tabulator");return u.innerHTML=p.innerHTML,p.innerHTML="",s.id=n,d.innerHTML=" X ",d.style.color="#ffeeee",d.style["font-weight"]="bold",d.style["margin-left"]="2em",d.style.background="#000000",d.style.padding="0.2em;",d.style["border-radius"]||="0.2em",d.addEventListener("click",(e=>{e.target.parentNode.parentNode.style.display="none"})),s.style=t.style||{},s.style.position||="absolute",s.style["z-index"]||=3,s.style.background||="#f1f1f1",s.style.border||="1px solid #d3d3d3",s.style["text-align"]||=":center",c.style=t.headerStyle||{},c.style.padding||="10px",c.style.cursor||="move",c.style["z-index"]||=4,c.style["text-align"]||="center",c.style.background||="#2196F3",c.style.color||="#ffffff",u.style=t.style||{},u.style.padding||="1em",s.onmousedown=e=>{(e=e||window.event).preventDefault(),a=e.clientX,i=e.clientY,document.onmouseup=e=>{document.onmouseup=null,document.onmousemove=null},document.onmousemove=e=>{(e=e||window.event).preventDefault(),o=a-e.clientX,l=i-e.clientY,a=e.clientX,i=e.clientY,s.style.top=s.offsetTop-l+"px",s.style.left=s.offsetLeft-o+"px"}},c.appendChild(d),s.appendChild(c),s.appendChild(u),document.body.appendChild(s),s}const E=UI.authn.authSession,M=document.querySelector("[data-suic=login]");async function x(e){if(solidUI.initApp||=async()=>{},!M&&!e)return await solidUI.initApp();M.innerHTML="",M.appendChild(UI.login.loginStatusBox(document,null,{}));const t=M.querySelectorAll("input")[1];t&&(t.style.display="none");let n=await UI.authn.checkUser(),r=M.querySelector("input"),o=M.dataset,l=o.inlabel,a=o.outlabel,i=o.transparent;n?(M.style.display="inline-block",r.value=a||"Log out!",r.title="--- logged in as "+n.value+"\n--- click to logout"):(M.style.display="inline-block",r.value=l||"Log in!",r.title="--- click to log in!"),i&&(r.style.backgroundColor="transparent"),r=solidUI.styleButton(r,{}),n&&(r.style.color="green"),"undefined"==typeof solidUI||e||await solidUI.initApp()}document.addEventListener("DOMContentLoaded",(function(){E&&M&&(M.style.display="none",E.onLogin(x),E.onLogout(x),E.onSessionRestore(x)),x()}));const H=new p;H.mungeLoginArea=x;const $=new c;let q=new class{skos=UI.rdf.Namespace("http://www.w3.org/2004/02/skos/core#");ui=UI.rdf.Namespace("http://www.w3.org/ns/ui#");rdf=UI.rdf.Namespace("http://www.w3.org/1999/02/22-rdf-syntax-ns#");constructor(){"undefined"!=typeof panes&&(window.outliner=panes.getOutliner(document))}suic="[data-suic]";async init(){let e=document.querySelectorAll(this.suic);for(let t of e){const e=await this.processComponent(t);e&&t.appendChild(e)}}async handleLinkClick(e,t){let n=e.link,r=e.linktype;if(e.preventDefault){e.preventDefault();let t=e.target;n=t.dataset.link,r=t.dataset.linktype||""}let o=document.querySelector(t.displayArea);if(q.hideTabulator&&q.hideTabulator(),"Replace"===r)window.location.href=n;else{if("External"===r)return await H.showIframeSrc(n,t.displayArea);if("SolidOS"===r)await H.show("SolidOSLink",n,null,null,null,t);else{if("resourceSelector"===r)return await U(t);if("Component"!==r||e.dataOnly){if("Component"===r&&e.dataOnly){let e=await this.getComponentHash(t.dataSource,t);return e.contentSource=t.dataSource,e.contentArea=t.contentArea,e.displayArea=t.displayArea,e}{let e=await H.show(r,n,null,t.displayArea,null,t);document.querySelector(t.displayArea).innerHTML="",document.querySelector(t.displayArea).appendChild(e)}}else{let e=document.createElement("DIV");e.dataset.suic=n,o.innerHTML="",o.appendChild(e),await q.initInternal(o)}}}}async initInternal(e){let t=e.querySelectorAll(this.suic);for(let e of t){const t=await this.processComponent(e);t&&e.appendChild(t)}return e}async activateComponent(e,t){t||=document;let n="string"==typeof e?document.querySelector(e):e,r=await this.getComponentHash(n.getAttribute("data-suic"));return r&&r.plugin&&n.setAttribute("data-suicPlugin",r.plugin),0===n.innerHTML.replace(/\s*/g,"").length&&(n=await this.processComponent(n),n&&(n.style||={},n.style.display="block")),n}pluginType(e){return!e||e.match(/(PodBrowser|SolidOS|FeedList|ConceptTree)/)?"builtIn":""}async showPage(e,t,n){let r;if(n&&n.link){n.cType=n.dataSourceType||="SolidOSLink",q.showTabulator&&q.showTabulator();let e=n.displayArea||document.body.getAttribute("data-suicDisplay");return r=await H.show(n.cType,n.link,"",e,!0,n),r}}styleButton(e,t){if(!e||!t)return e;"login"===e.id&&(e.style=t.style||{}),e.style.display||="inline-block",e.style.padding||="0.5rem";let n="transparent"===e.style.backgroundColor;return n&&(e.style.color=this.buttonBackground||q.buttonBackground,e.style.border="none"),n||(e.style.border||="1px solid "+this.buttonBackground||0,e.style["border-radius"]="0.2rem",e.style.backgroundColor||=this.buttonBackground||t.color,e.style.color||=this.buttonColor||t.background),e.style.margin="0.5rem",e.style["margin-left"]="0",e.style.cursor="pointer",e.style["font-size"]="100%",e}async processComponentJson(e){return await this.processComponent(null,null,e)}async processComponentSubject(e){return await this.processComponent(null,e)}async processComponent(e,t,n){if(!n){if(!t&&e&&e.dataset){let n=e.dataset.suic;n.startsWith("/")&&(n=window.origin+n),t=await this.loadUnlessLoaded(n)}if(!t)return null;n=await this.getComponentHash(t),e||={},e.dataset||={},e.parentNode||={},e.parentNode.dataset||={},n||=t,n.displayArea=e.dataset.display||e.parentNode.dataset.display,n.displayArea||=document.body.getAttribute("data-suicDisplay"),n.contentSource=t.value?t.value:t}if(n||=t,n.contentArea||=e,"string"==typeof n.contentArea&&(n.contentArea=document.querySelector(n.contentArea)),!(n="Default"===n.type?this.setDefaults(n):this.getDefaults(n)).plugin&&e&&e.getAttribute&&(n.plugin=e.getAttribute("data-suicPlugin")||{}),"Component"===n.type){if(n.plugin.match(/#ExternalApp/))return window.open(n.dataSource),"";if(n.plugin.match(/#PodBrowser/))return await U(n);if(n.plugin.match(/#SolidOSLink/))return H.show("SolidOSLink",n.href,null,null,null,n);let e=await this.getComponentHash(n.dataSource,n);e.contentSource=n.dataSource,e.contentArea=n.contentArea,e.displayArea=n.displayArea,n=e}if("Plugin"===n.type){let e={link:n.dataSource,linktype:n.pluginType,dataOnly:1};return this.handleLinkClick(e,n)}let r="string"==typeof n.dataSource?await this.getComponentHash(n.dataSource):n.dataSource;r&&"string"==typeof r.dataSource&&(r=await this.getComponentHash(r.dataSource));let o="Script"===n.type?n.content:null;if(o);else if(r&&"Script"===r.type){o=r.content;let e=await Function('"use strict";return('+o+")")();"string"==typeof n.contentArea?document.querySelector(n.contentArea):n.contentArea,n.parts=n.dataSource=r=e}if("SparqlComponent"===n.type)return e&&e.dataset&&e.dataset.template&&(n.template=e.dataset.template),e&&e.dataset&&e.dataset.endpoint&&(n.endpoint=e.dataset.endpoint),n.template="ui:"+n.template.replace(/^ui:/,""),await s({endpoint:n.endpoint,query:n.query,template:n.template,displayArea:n.contentArea});if(r&&"SparqlQuery"===r.type){let e=r.endpoint,t=r.query.replace(/\$\{[^\}]*\}/g,"");if(n.parts=await this.sparqlQuery(e,t,n),"SparqlQuery"===n.type)return n.parts}if("SparqlQuery"===n.type&&(n.parts=await this.sparqlQuery(n.endpoint,n.query,n),"SparqlQuery"===n.type))return n.parts;if("SolidOSLink"===n.type)return H.show("SolidOSLink",n.href,null,null,null,n);if("MediaList"===n.type)return async function(e){const t=document.createElement("SPAN");for(let n of e.parts)e.id=n.id,t.appendChild(await h(e));return t}(n);if(n.type===UI.ns.schema("MusicRecording").value)return h(n);if("PodSelector"===n.type)return async function(e){let t=[];for(let n of e.parts)t.push({value:n.dataSource,label:n.label});t=await L(t,(async t=>{let n=t.target.value;return e.dataSource=n,await U(e)}),0,0,6);let n=t[0]?t[0].value:t,r=document.createElement("DIV");r.style="width:100% !important;text-align:right",r.innerHTML=`\n       <span style="color:white !important">Pod Explorer</span>\n       <a href="${n}" style="display:inline-block !important;color:gold !important;text-align:right !important;"><img src="https://solidproject.org/assets/img/solid-emblem.svg" style="height:2rem;width:2rem;margin-left:2rem;" /></a>\n    `;let o="string"==typeof e.contentArea?document.querySelector(e.contentArea):e.contentArea;o.innerHTML="",o.appendChild(r),o.appendChild(t),e.dataSource=t[0]?t[0].value:t,await U(e)}(n);if("PageElement"===n.type){for(let t of n.dataSource)t.contentArea=e,t.targetArea=n.displayArea,await this.processComponentJson(t);return document.createElement("SPAN")}if(n.parts&&n.groupOn&&(n.parts=$.flatten(n.parts,n.groupOn),console.log(n.groupOn,n.parts)),"App"===n.type)return await(new g).render(this,n);if("MarkdownContent"===n.type)return H.show("markdown",null,n.value,n.displayArea,null,n);if(n.type&&n.type.match(/Link/))return await window.displayLink(e,n,e);if(n.type&&n.type.match(/ButtonListMenu/))return await async function(e){e.displayArea&&e.startingContent&&await solidUI.util.show("",e.startingContent,"",e.displayArea);let t=e.displayArea;t="string"==typeof t?document.querySelector(t):t;let n=document.createElement("DIV"),r=e.dataSource;void 0===r.length&&(r=[r]);for(let t of r){let r=document.createElement("BUTTON");r.dataset.link=t.link||t.dataSource,r.dataset.label=t.label,r.dataset.linktype=t.linktype||t.pluginType,r.innerHTML=t.label,r.value=t.dataSource,r=solidUI.styleButton(r,e),r.style["font-size"]="100%",r.addEventListener("click",(async t=>solidUI.handleLinkClick(t,e))),n.appendChild(r)}return n.style["text-align"]="center",n}(n);if(n.type&&n.type.match(/searchButton/))return await async function(e){const t=document.createElement("DIV"),n=e.contentArea||document.body,r=document.createElement("BUTTON"),o=document.createElement("INPUT");r.title=e.title,t.appendChild(o),n.appendChild(r),n.appendChild(t),t.style="display:none;z-index:10;position:absolute;left:2.2rem; margin-top:-1rem; padding:0.4rem;background:brown;border-radius:0.4rem;",r.innerHTML=e.label||"&#x26B2;",r.style="transform:rotate(315deg);font-size:1.75rem;",r.addEventListener("click",(async()=>{t.style.display="block"})),o.style="padding:0.5rem;width:60ch;border-radius:0.2rem",o.placeholder=e.placeholder,o.addEventListener("keypress",(async e=>{if("Enter"===e.key){t.style.display="none";const e=o.value;e&&solidUI.util.show("SolidOSLink",e,"","#display")}}))}(n);if("Menu"===n.type)return await(new w).render(this,n,e);if("CustomTemplate"===n.type){let e=n.recurring,t=n.before||"",r=n.after||"";e=e||v;let o=this.fillTemplate(e,n.parts),l=document.createElement("DIV");l.innerHTML=t+o+r,l.style.overflow="hidden";let a=document.getElementById("solidOSdatabrowser"),i=document.getElementById("display");for(let e of l.querySelectorAll("A"))e.addEventListener("click",(async t=>{if(t.preventDefault(),e.dataset.format.match(/SolidOSLink/))return a.style.display="block",i.style.display="none",n.dataSourceType||="SolidOSLink",await H.show("rdf",e.href,"",null,!0,n);a.style.display="none",i.style.display="block",H.showIframeSrc(e.href,"#display")})),e.style.display="block",e.style["padding-left"]="0.25rem",e.style.background=q.buttonBackground,e.style.color=q.buttonColor;return l}if("MenuOfMenus"===n.type)return await async function(e){let t=document.querySelector(e.displayArea);if(t&&e.startingContent){let n=await solidUI.processComponentSubject(e.startingContent);n&&t.appendChild(n)}let n=document.createElement("DIV");n.id=e.contentSource.replace(/.*\#/,"");let r="";for(let t of e.dataSource){let e=t.directDisplay?t.dataSource:t.id;t.directDisplay||="",t.plugin&&t.plugin.match(/External/)&&(t.external="true"),r+=`<button about="${e}" data-directDisplay="${t.directDisplay}" data-external="${t.external}">${t.label}</button>`}n.innerHTML=r;let o="string"==typeof e.contentArea?document.querySelector(e.contentArea):solidUI.currentElement;o.innerHTML="",o.appendChild(n);for(let t of e.dataSource){let e=document.createElement("DIV");e.id=t.label.replace(/\s*/g,"_"),e.setAttribute("data-suic",t.id),e.style="display:none",o.appendChild(e)}let l=o.querySelectorAll("BUTTON");for(let t of l){t=solidUI.styleButton(t,e);let n=t.getAttribute("about");t.addEventListener("click",(async r=>{r.preventDefault();let l=t.getAttribute("data-external");l="undefined"===l?null:l;let a=t.getAttribute("data-directDisplay");a="undefined"===a?null:a;let i=t.getAttribute("about");if(a)return void await solidUI.showPage(null,{link:i,displayArea:o});if(l)return solidUI.processComponentSubject(i);let s=o.querySelectorAll(e.contentArea+" > DIV");for(let e of s)e.getAttribute("data-suic")===n?(e.style.display="block",await solidUI.activateComponent(e,o)):e.style.display="none"}))}return o}(n);if("ComponentButton"===n.type)return await async function(e){let t=e;"object"!=typeof e&&(t=await async function(e){let t=UI.rdf.Namespace("http://www.w3.org/ns/ui#"),n={};return e=UI.rdf.sym(e),await UI.store.fetcher.load(e),n.label=(UI.store.any(e,t("label"))||{}).value,n.content=(UI.store.any(e,t("icon"))||{}).value,n.style=(UI.store.any(e,t("style"))||{}).value,n.headerstyle=(UI.store.any(e,t("headerStyle"))||{}).value,n.dataSource=(UI.store.any(e,t("dataSource"))||{}).value,n}(e));let n=document.createElement("BUTTON");return n.innerHTML=t.icon?t.icon:t.label,n.addEventListener("click",(async e=>{await solidUI.processComponent(null,t.dataSource)})),n.style=t.style,n.style.cursor||="pointer",n.style.background||="#2196F3",n.style.color||="#ffffff",n.style.padding||="0.5em",n.style["border-radius"]||="0.2em",t.targetSelector&&t.targetSelector.appendChild(n),n}(n);if("Draggable"===n.type)return await A(n);if("ResourceSelector"===n.type)return await U(n);if("FeedList"===n.type)return await(new m).makeFeedSelector(n.contentSource,n.contentArea,n.displayArea,n);if("BookmarkTree"===n.type)document.createElement("UL"),await(new S).getTopic(n.contentSource,n.contentArea,n.displayArea,"start"),("string"==typeof n.contentArea?document.querySelector(n.contentArea):n.contentArea).style.listStyle="none",document.getElementById("ocbStart").click();else{if("OptionSelector"===n.type)return this.setDefaults(n),await y(n);if("ModalButton"===n.type)return await(new k).render(n,this);if("Accordion"===n.type)return await(new f).render(this,n);if("Form"===n.type)return await(new u).render(n);if("Tabset"===n.type)return await async function(e){const t=e.parts.map((e=>e.dataSource));e.displayArea&&e.startingContent&&await solidUI.processComponentSubject(e.startingContent),e.renderTab||=(t,n)=>{t.innerHTML=(t=>{for(let n of e.parts)if(n.dataSource===t)return n.label})(n)},e.renderMain||=async(t,n)=>{t.setAttribute("data-suic-area","tab-display"),t.innerHTML="",e.style&&(t.style="options.style");let r=await solidUI.processComponentSubject(n);t.appendChild(r)};const n={items:t,backgroundColor:e.backgroundColor||solidUI.menuBackground,orientation:e.orientation,dom:e.dom,onClose:e.onClose,ordered:e.ordered,selectedTab:e.selectedTab,startEmpty:e.startEmpty,renderTab:e.renderTab,renderMain:e.renderMain,renderTabSettings:e.renderTabSettings};return UI.tabs.tabWidget(n)}(n)}if("Table"===n.type)return await(new builtIn.Table).render(n);if(n.type&&n.type.match(/Button/))return await async function(e){const t=e.contentArea||document.body;let n=document.createElement("BUTTON");n.innerHTML=e.label,e.title&&(n.title=e.title),e.style&&(n.style=e.style),n=solidUI.styleButton(n,e),n.addEventListener("click",(t=>{alert(e.onclick),window[e.onclick](t)})),t.appendChild(n)}(n);let l,a,i,c,p,b=document.createElement("DIV");"Record"===n.type&&(p=this.getValue(r,ui("label")),c=this.getValue(r,ui("content")),l={label:p,content:c}),l=l||n.parts,this.log("Parts for Component",l);let I,v=n.template;if(!v)return l;if(v.groupOn&&(l=$.flatten(l,v.groupOn)),"AccordionMenu"==v){let e=await this.runBuiltIn(v,l);return e&&b.appendChild(e),b}if("Table"==v||"Table"===n.type){let e=await(new d).render(n);return e&&b.appendChild(e),b}if("ModalButton"==v){let e=await this.makeMmodal(n.label,n.content);return e&&b.appendChild(e),b}"string"==typeof v&&(v=await this.getComponentHash(v)),I=v.recurring,a=v.before,i=v.after;let C=this.fillTemplate(I,l);return b.innerHTML=(a||"")+C+(i||""),b}getObjects(e,t,n,r){let o=e.each(t,n,null,r);if(0===o.length)return o;let l=o[0].termType,a=e.any(o[0],this.rdf("first"));return"Collection"===l?o[0].elements:a?this.getRdfsList(e,o[0]):o}getRdfsList(e,t,n){n||=[],n.push(e.any(t,this.rdf("first")));let r=e.any(t,this.rdf("rest"));return r&&r.value===this.rdf("nil").value?n:this.getRdfsList(e,r,n)}async getComponentHash(e,t){if(!e)return t;if(!e.value&&"string"==typeof e&&e.startsWith("/")&&(e=window.origin+e),!(e=await this.loadUnlessLoaded(e)))return null;let n=UI.store.match(e,null,null);t=t||{};for(let r of n){let n=r.predicate.value.replace(/http:\/\/www.w3.org\/1999\/02\/22-rdf-syntax-ns#/,"").replace(/http:\/\/www.w3.org\/ns\/ui#/,""),o=r.object,l=e.doc?e.doc():e;if(this.getObjects(UI.store,e,r.predicate,l),t[n]||=[],"BlankNode"===o.termType)o=await this.getComponentHash(o),t[n]?"ARRAY"!=typeof t[n]?t[n]=[o]:t[n].push(o):t[n]=o;else if("Collection"===o.termType){o=o.elements;for(let e of o){let r=await this.getComponentHash(e,{});t[n]?t[n].push(r):t[n]=[r]}}else o=o.value.replace(/^http:\/\/www.w3.org\/ns\/ui#/,""),t[n]?"ARRAY"!=typeof t[n]?t[n]=[o]:t[n].push(o):t[n]=o;1==t[n].length&&(t[n]=t[n][0])}return t.id||=e.value,t}log(...e){"undefined"!=typeof DEBUG&&console.log(e)}setStyle(e,t){for(let n of Object.keys(t))e.style[n]=t[n]}async sparqlQuery(e,t,n){return"undefined"!=typeof Comunica?await $.comunicaQuery(e,t,n):await $.rdflibQuery(e,t,n)}getDefaults(e){return"string"==typeof e&&(e=this.processComponent("",e)),e.height||=this.height,e.width||=this.width,e.proxy||=this.proxy||"/proxy?uri=",this.proxy=e.proxy,e}setDefaults(e){if("string"==typeof e&&(e=this.processComponent("",e)),"Default"===e.type)for(let t of Object.keys(e))this[t]=e[t];return this.pageBackground=e.pageBackground||"#ffffff",this.pageColor=e.pageColor||"#000000",this.pageHighlight=e.pageHightlight||"#666666",this.widgetBackground=this.buttonBackground=e.widgetBackground||e.buttonBackground||"#c0c0c0",this.widgetColor=this.buttonColor=e.widgetColor||e.buttonColor||"#000000",this.widgetHighlight=this.menuBackground=e.widgetHighlight||"#c0c0c0",this.menuColor=e.menuColor||"#000000",this.menuAltColor=e.menuAltColor||"green",document.body.style["background-color"]=this.pageBackground,document.body.style.color=this.pageColor,this.orientation=e.orientation,this.position=e.position,this.proxy=e.proxy,this.getDefaults(e)}runBuiltIn(e,t,n){return t.match(/Table/)?this.results2table(e,n):t.match(/Modal/)?this.results2modal(n):t.match(/Accordion/)?tabset(n):t.match(/DescriptionList/)?this.results2descriptionList(n):void 0}async loadTheme(e){try{let t=UI.rdf.Namespace(e+"#");await UI.store.fetcher.load(e);let n=UI.store.match(t("this"));n&&(n=await this.processComponentSubject(n))}catch(e){alert(e)}}async processTemplate(e,t,n){let r;if("string"==typeof e)r=e.startsWith("ui:")?await this.builtIn({template:e,parts:t}):await this.CustomTemplate({template:e,parts:t});else{e.groupOn&&(t=$.flatten(t,e.groupOn));let n=e.recurring,o=e.before,l=e.after;n&&(r=n.interpolate(t)),r=(o||"")+(r||"")+(l||"")}return n||=document.createElement("DIV"),"string"!=typeof r?(n.innerHTML="",n.appendChild(r)):n.innerHTML=r,n}RecordsList=async e=>{let t=i.RecordsList.split(/\[~LOOP~\]/),n=t.length,r=3===n?t[1].replace(/\[~/g,"${").replace(/~]/g,"}"):t[0],o=3===n?t[0]:"",l=3===n?t[2]:"";for(let t of e.parts){let e="";for(let n of Object.keys(t))e+=r.interpolate({key:n,val:t[n]});o+=e+"<hr>"}return o+=l,o};CustomTemplate=async e=>{let t=e.template.split(/\[~LOOP~\]/),n=t.length,r=3===n?t[1].replace(/\[~/g,"${").replace(/~]/g,"}"):t[0],o=3===n?t[0]:"",l=3===n?t[2]:"";for(let t of e.parts)o+=r.interpolate(t);return o+=l,o};SimpleSelector(e){let t=document.createElement("SELECT");t.style=`width:240px;height:2.5rem;font-size: 100%;border-radius: 0.5rem;padding:0.5rem;background:${q.widgetBackground};font-size:100%;color:${widgetColor};outline:none;`;for(let n of e){let e=document.createElement("OPTION");e.value=n.link,e.innerHTML=n.label,e.style=`background:${q.widgetHighlight};font-size:110%;color:black;`,t.appendChild(e)}return t}templates={Table:async e=>await(new d).render(e),JSON:e=>JSON.stringify(e.parts,4)};async builtIn(e){e.template=e.template.replace(/^ui:/,"");const t=this[e.template]||this.templates[e.template];return t?await t(e):(alert(`Bad template name '${e.template}'!`),"")}async processBuiltInTemplate(e,t,n){return"JSON"===(e=e.replace(/^ui:/,""))?JSON.stringify(t,4,4):"RecordsList"===e?await this.processCustomTemplate(templateString,t):void 0}fillTemplate(e,t){function n(e,t){for(let n of Object.keys(t)){let r=t[n]||" ";"object"==typeof r&&r.length>1&&(r=r.join(", "));let o=new RegExp(`\\$\\{${n}\\}`,"gi");e=e.replace(o,r)}return e}let r="";for(let o of t)r+=n(e,o)+"\n";return r}diff(e,t){e.split(t).join("")}simulateClick(e){if(e.fireEvent)e.fireEvent("onclick");else{var t=document.createEvent("Events");t.initEvent("click",!0,!1),e.dispatchEvent(t)}}createElement(e,t,n,r){let o=document.createElement(e);if(t&&o.classList.add(t),n&&(o.innerHTML=n),r)for(let e of r.split(/;/)){let t=e.split(/:/);2==t.length&&(o.style[t[0].trim()]=t[1].trim())}return o}getComponentType(e){return e?UI.store.each(e,rdf("type")).map((e=>{if((e=e.value).match(/ns\/ui#/))return e.replace(/.*\#/,"")}))[0]||"":null}async clearInline(){for(let e of UI.store.match())e.graph.value.startsWith("inline:")&&UI.store.remove(e)}loadFromMemory(e){let t=e;if(UI.store.any(null,null,null,UI.rdf.sym(t)))return UI.rdf.sym(t);let[n,r]=t.split(/#/),o=document.getElementById(n),l=o.innerText||o.value;l=l.trim(),l.startsWith("<![CDATA[")&&(l=l.replace(/^\<\!\[CDATA\[/,"").replace(/\]\]$/,"").replace(/~~/g,"#"));try{return UI.rdf.parse(l,UI.store,t,"text/turtle"),UI.rdf.sym(t)}catch(e){console.log(e)}}async loadUnlessLoaded(e){try{if(!e)return;if(e&&e.termType&&"BlankNode"===e.termType)return e;if(!(e="object"==typeof e?e.uri:e))return;if(e.startsWith("inline"))return this.loadFromMemory(e);e.startsWith("http")||e.startsWith("ls")||(e=window.location.href.replace(/\/[^\/]*$/,"/")+e);const t=e.replace(/\#[^#]*$/,"");let n=UI.rdf.sym(t);return UI.store.any(null,null,null,n)||(console.log("loading "+n.uri+" ..."),await UI.store.fetcher.load(n.uri),UI.store.any(null,null,null,n)?console.log(`<${n.uri}> loaded!`):console.log(`<${n.uri}> could not be loaded!`)),UI.rdf.sym(e)}catch(t){return console.log(t),UI.rdf.sym(e)}}getValue(e,t,n,r){let o=UI.store.any(e,t,n,r);return o?o.value:""}valuesContain(e,t,n,r,o){let l=UI.store.each(e,t,n,r);for(let e of l)if(e=e?e.value:"",e===o)return e}};q.util=H,q.draggable=A,q.runQuery=s.bind(q)})();